---
phase: 04-conversational-discovery-a-submodule-support
plan: 06
type: execute
wave: 3
depends_on: [04-02, 04-04]
files_modified:
  - src/components/discovery/SubmodulePreview.tsx
  - src/components/discovery/SubmoduleItem.tsx
  - src/components/discovery/index.ts
autonomous: true

must_haves:
  truths:
    - "User sees detected submodules in preview"
    - "User sees submodule paths including prototype locations"
    - "User can see which submodules were scanned vs skipped"
    - "Auth-required submodules show appropriate status"
  artifacts:
    - path: "src/components/discovery/SubmodulePreview.tsx"
      provides: "Submodule preview section"
      exports: ["SubmodulePreview"]
    - path: "src/components/discovery/SubmoduleItem.tsx"
      provides: "Individual submodule display"
      exports: ["SubmoduleItem"]
  key_links:
    - from: "src/components/discovery/SubmodulePreview.tsx"
      to: "src/lib/discovery/types.ts"
      via: "type imports"
      pattern: "import.*DiscoveredSubmodule"
---

<objective>
Create UI components to display detected Git submodules and their scanned content in the discovery preview.

Purpose: Users need to see which submodules were detected, which were scanned, and what content (like prototype paths) was found within them. This implements SUBM-03 (show submodule structure in preview).

Output: SubmodulePreview section and SubmoduleItem components for displaying submodule information.
</objective>

<execution_context>
@/Users/tylersahagun/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tylersahagun/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/lib/discovery/types.ts
@src/components/discovery/AgentItem.tsx
@src/components/discovery/AgentPreview.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SubmoduleItem component</name>
  <files>src/components/discovery/SubmoduleItem.tsx</files>
  <action>
Create a component that displays a single submodule with its status:

```typescript
"use client";

import { motion } from "framer-motion";
import { cn } from "@/lib/utils";
import {
  GitBranch,
  Check,
  AlertCircle,
  Lock,
  FolderOpen,
  Loader2,
} from "lucide-react";
import type { DiscoveredSubmodule } from "@/lib/discovery/types";

interface SubmoduleItemProps {
  submodule: DiscoveredSubmodule;
  isScanning?: boolean;
}

/**
 * Get status badge info for a submodule
 */
function getStatusBadge(submodule: DiscoveredSubmodule, isScanning: boolean): {
  icon: React.ElementType;
  label: string;
  className: string;
} {
  if (isScanning) {
    return {
      icon: Loader2,
      label: "Scanning...",
      className: "bg-blue-500/20 text-blue-400",
    };
  }

  if (submodule.requiresAuth && !submodule.scanned) {
    return {
      icon: Lock,
      label: "Auth required",
      className: "bg-amber-500/20 text-amber-400",
    };
  }

  if (submodule.scanError) {
    return {
      icon: AlertCircle,
      label: "Error",
      className: "bg-red-500/20 text-red-400",
    };
  }

  if (submodule.scanned) {
    return {
      icon: Check,
      label: "Scanned",
      className: "bg-green-500/20 text-green-400",
    };
  }

  return {
    icon: GitBranch,
    label: "Detected",
    className: "bg-gray-500/20 text-gray-400",
  };
}

export function SubmoduleItem({ submodule, isScanning = false }: SubmoduleItemProps) {
  const statusBadge = getStatusBadge(submodule, isScanning);
  const StatusIcon = statusBadge.icon;

  return (
    <motion.div
      initial={{ opacity: 0, y: 5 }}
      animate={{ opacity: 1, y: 0 }}
      className="p-3 rounded-lg border border-white/10 bg-white/5"
    >
      <div className="flex items-start justify-between gap-3">
        {/* Left: Icon and info */}
        <div className="flex items-start gap-3 min-w-0">
          <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-orange-500/20 to-red-500/20 flex items-center justify-center flex-shrink-0">
            <GitBranch className="w-4 h-4 text-orange-400" />
          </div>

          <div className="min-w-0 flex-1">
            <div className="flex items-center gap-2">
              <span className="font-medium text-sm truncate">
                {submodule.name}
              </span>
              <span
                className={cn(
                  "inline-flex items-center gap-1 text-[10px] px-1.5 py-0.5 rounded-full",
                  statusBadge.className
                )}
              >
                <StatusIcon
                  className={cn(
                    "w-3 h-3",
                    isScanning && "animate-spin"
                  )}
                />
                {statusBadge.label}
              </span>
            </div>

            <p className="text-xs text-muted-foreground font-mono mt-0.5 truncate">
              {submodule.path}
            </p>

            {/* Show prototype path if found */}
            {submodule.prototypePath && (
              <div className="flex items-center gap-1.5 mt-1.5">
                <FolderOpen className="w-3 h-3 text-purple-400" />
                <span className="text-xs text-purple-300">
                  Prototypes: <span className="font-mono">{submodule.prototypePath}</span>
                </span>
              </div>
            )}

            {/* Show error if present */}
            {submodule.scanError && (
              <p className="text-xs text-red-400 mt-1.5">
                {submodule.scanError}
              </p>
            )}
          </div>
        </div>

        {/* Right: Branch info if available */}
        {submodule.branch && (
          <span className="text-[10px] text-muted-foreground flex-shrink-0">
            {submodule.branch}
          </span>
        )}
      </div>
    </motion.div>
  );
}
```
  </action>
  <verify>Run `npx tsc --noEmit` - component should compile without errors</verify>
  <done>SubmoduleItem component created</done>
</task>

<task type="auto">
  <name>Task 2: Create SubmodulePreview component</name>
  <files>src/components/discovery/SubmodulePreview.tsx</files>
  <action>
Create a component that displays all submodules as a section in the discovery preview:

```typescript
"use client";

import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { ChevronDown, ChevronRight, GitBranch, Info } from "lucide-react";
import { cn } from "@/lib/utils";
import { SubmoduleItem } from "./SubmoduleItem";
import type { DiscoveredSubmodule } from "@/lib/discovery/types";

interface SubmodulePreviewProps {
  submodules: DiscoveredSubmodule[];
  scanningSubmodulePaths?: Set<string>;  // Paths currently being scanned
  className?: string;
}

export function SubmodulePreview({
  submodules,
  scanningSubmodulePaths = new Set(),
  className,
}: SubmodulePreviewProps) {
  const [isExpanded, setIsExpanded] = useState(true);

  if (submodules.length === 0) {
    return null;
  }

  // Calculate stats
  const scannedCount = submodules.filter(s => s.scanned).length;
  const authRequiredCount = submodules.filter(s => s.requiresAuth && !s.scanned).length;
  const errorCount = submodules.filter(s => s.scanError).length;
  const prototypesFound = submodules.filter(s => s.prototypePath).length;

  return (
    <div className={cn("space-y-3", className)}>
      {/* Header */}
      <button
        onClick={() => setIsExpanded(!isExpanded)}
        className="w-full flex items-center justify-between p-2 rounded-lg hover:bg-white/5 transition-colors"
      >
        <div className="flex items-center gap-2">
          {isExpanded ? (
            <ChevronDown className="w-4 h-4 text-muted-foreground" />
          ) : (
            <ChevronRight className="w-4 h-4 text-muted-foreground" />
          )}
          <GitBranch className="w-4 h-4 text-orange-400" />
          <span className="font-medium text-sm">Git Submodules</span>
          <span className="text-xs text-muted-foreground">
            ({submodules.length})
          </span>
        </div>

        {/* Quick stats */}
        <div className="flex items-center gap-2 text-[10px]">
          {scannedCount > 0 && (
            <span className="text-green-400">{scannedCount} scanned</span>
          )}
          {authRequiredCount > 0 && (
            <span className="text-amber-400">{authRequiredCount} need auth</span>
          )}
          {errorCount > 0 && (
            <span className="text-red-400">{errorCount} errors</span>
          )}
        </div>
      </button>

      {/* Content */}
      <AnimatePresence>
        {isExpanded && (
          <motion.div
            initial={{ opacity: 0, height: 0 }}
            animate={{ opacity: 1, height: "auto" }}
            exit={{ opacity: 0, height: 0 }}
            className="space-y-2 pl-6"
          >
            {/* Info message about prototypes */}
            {prototypesFound > 0 && (
              <div className="flex items-start gap-2 p-2 rounded-lg bg-purple-500/10 border border-purple-500/20">
                <Info className="w-4 h-4 text-purple-400 flex-shrink-0 mt-0.5" />
                <p className="text-xs text-purple-200">
                  Found {prototypesFound} prototype folder{prototypesFound === 1 ? "" : "s"} in submodules.
                  These paths will be configured for prototype generation.
                </p>
              </div>
            )}

            {/* Auth required info */}
            {authRequiredCount > 0 && (
              <div className="flex items-start gap-2 p-2 rounded-lg bg-amber-500/10 border border-amber-500/20">
                <Info className="w-4 h-4 text-amber-400 flex-shrink-0 mt-0.5" />
                <p className="text-xs text-amber-200">
                  {authRequiredCount} submodule{authRequiredCount === 1 ? "" : "s"} from different organizations
                  {authRequiredCount === 1 ? " requires" : " require"} separate authentication.
                  You can configure access after setup.
                </p>
              </div>
            )}

            {/* Submodule list */}
            {submodules.map((submodule) => (
              <SubmoduleItem
                key={submodule.path}
                submodule={submodule}
                isScanning={scanningSubmodulePaths.has(submodule.path)}
              />
            ))}
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
}
```
  </action>
  <verify>Run `npx tsc --noEmit` - component should compile without errors</verify>
  <done>SubmodulePreview component created</done>
</task>

<task type="auto">
  <name>Task 3: Export components from barrel file</name>
  <files>src/components/discovery/index.ts</files>
  <action>
Add exports for the new submodule components to the discovery components barrel file:

```typescript
export { SubmoduleItem } from './SubmoduleItem';
export { SubmodulePreview } from './SubmodulePreview';
```

Add these after the existing exports. Do NOT remove any existing exports.
  </action>
  <verify>Run `npx tsc --noEmit` - barrel file should compile without errors</verify>
  <done>Components exported from barrel file</done>
</task>

</tasks>

<verification>
- TypeScript compiles: `npx tsc --noEmit`
- Components import correctly: `import { SubmodulePreview, SubmoduleItem } from '@/components/discovery'`
- SubmoduleItem shows status badge (Scanned, Auth required, Error, Detected)
- SubmodulePreview shows collapsible list with stats
</verification>

<success_criteria>
- SubmoduleItem displays submodule name, path, and branch
- Status badges show correct state (scanned, auth required, error, scanning)
- Prototype paths highlighted when found
- SubmodulePreview shows collapsible section with all submodules
- Stats show scanned/auth-required/error counts
- Info messages explain prototype paths and auth requirements
- Components exported from barrel file
</success_criteria>

<output>
After completion, create `.planning/phases/04-conversational-discovery-a-submodule-support/04-06-SUMMARY.md`
</output>
