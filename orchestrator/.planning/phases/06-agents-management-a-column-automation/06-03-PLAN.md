---
phase: 06-agents-management-a-column-automation
plan: 03
type: execute
wave: 2
depends_on: ["06-01", "06-02"]
files_modified:
  - src/components/agents/AgentExecutionPanel.tsx
  - src/components/agents/ContextSelector.tsx
  - src/components/agents/AgentCard.tsx
  - src/app/api/agents/execute/route.ts
autonomous: true

must_haves:
  truths:
    - "User can select projects or signals as context"
    - "User can execute agents from the Agents page"
    - "Execution creates a job that can be tracked"
  artifacts:
    - path: "src/components/agents/AgentExecutionPanel.tsx"
      provides: "Agent execution UI with context selection"
      exports: ["AgentExecutionPanel"]
    - path: "src/components/agents/ContextSelector.tsx"
      provides: "Project/Signal selector component"
      exports: ["ContextSelector"]
  key_links:
    - from: "src/components/agents/AgentExecutionPanel.tsx"
      to: "/api/agents/execute"
      via: "POST request to execute agent"
      pattern: "fetch.*api/agents/execute"
---

<objective>
Add the ability to select context (projects or signals) and execute agents from the Agents page.

Purpose: Users need to run agents with specific context directly from the Agents page (AGUI-04).

Output: Execution panel with context selector that triggers agent jobs.
</objective>

<execution_context>
@/Users/tylersahagun/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tylersahagun/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing patterns
@src/app/api/agents/execute/route.ts (existing execute endpoint)
@src/lib/db/queries.ts (createJob, listProjects)
@src/components/ui/command.tsx (cmdk for selection)
@src/app/api/projects/route.ts (projects list endpoint)
@src/app/api/signals/route.ts (signals list endpoint)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ContextSelector component</name>
  <files>src/components/agents/ContextSelector.tsx</files>
  <action>
Create a context selector component using cmdk:

Props:
- workspaceId: string
- contextType: "project" | "signal" | "none"
- selectedId: string | null
- onSelect: (type: "project" | "signal" | "none", id: string | null) => void

Features:
1. Tab buttons to switch between "No Context", "Project", "Signal"
2. When Project or Signal selected, show searchable list using cmdk Command component
3. Fetch projects from /api/projects?workspaceId={id}
4. Fetch signals from /api/signals?workspaceId={id}
5. Display selected item name below selector
6. Clear selection button

Style with existing Popover + Command pattern from BranchSelector or GithubRepoSelector.
  </action>
  <verify>Component renders, can switch context types, can select items</verify>
  <done>ContextSelector allows selecting projects or signals</done>
</task>

<task type="auto">
  <name>Task 2: Create AgentExecutionPanel component</name>
  <files>src/components/agents/AgentExecutionPanel.tsx</files>
  <action>
Create execution panel shown when user wants to run an agent:

Props:
- agent: AgentDefinition
- workspaceId: string
- onExecute: (jobId: string) => void
- onCancel: () => void

Features:
1. Show agent name and type at top
2. ContextSelector for choosing context
3. "Execute" button (disabled if context required but not selected)
4. Loading state during execution
5. POST to /api/agents/execute with:
   - workspaceId
   - agentDefinitionId: agent.id
   - projectId (if project selected)
   - signalId (if signal selected)
6. On success, call onExecute with returned job.id
7. Show toast on success/error using sonner

Style as a slide-out panel or modal from the right side.
  </action>
  <verify>Panel opens, can select context, execute button triggers job</verify>
  <done>AgentExecutionPanel allows executing agents with context</done>
</task>

<task type="auto">
  <name>Task 3: Wire execution into AgentCard</name>
  <files>
    src/components/agents/AgentCard.tsx
    src/components/agents/index.ts
  </files>
  <action>
Add execution button to AgentCard:

1. Add "Execute" button (Play icon) to card header/actions area
2. On click, open AgentExecutionPanel as a Sheet/Dialog
3. After successful execution, show toast with link to view job logs
4. Pass workspaceId down from AgentsList

Update index.ts to export new components.
  </action>
  <verify>Click execute on agent card opens execution panel, can run agent</verify>
  <done>Agents can be executed from their cards</done>
</task>

</tasks>

<verification>
1. Click "Execute" on agent card - opens execution panel
2. Select "Project" context - shows project list
3. Select a project - shows selected project name
4. Click "Execute" - creates job, shows toast
5. Can execute with no context selected
6. Can execute with signal selected
</verification>

<success_criteria>
- AGUI-04: User can select projects or signals as context and execute agents from this page
- Job created and trackable via existing job infrastructure
- User feedback via toasts
</success_criteria>

<output>
After completion, create `.planning/phases/06-agents-management-a-column-automation/06-03-SUMMARY.md`
</output>
