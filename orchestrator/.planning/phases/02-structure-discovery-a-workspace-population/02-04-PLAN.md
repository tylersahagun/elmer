---
phase: 02-structure-discovery-a-workspace-population
plan: 04
type: execute
wave: 2
depends_on: ["02-01", "02-02"]
files_modified:
  - src/components/discovery/DiscoveryPreview.tsx
  - src/components/discovery/InitiativeItem.tsx
  - src/components/discovery/ColumnGroup.tsx
  - src/components/discovery/index.ts
autonomous: true

must_haves:
  truths:
    - "User sees visual mapping preview showing initiatives grouped by target column"
    - "User sees each initiative's name, source path, and mapped status/column"
    - "Ambiguous status mappings are visually distinct for user review"
  artifacts:
    - path: "src/components/discovery/DiscoveryPreview.tsx"
      provides: "Main preview container component"
      exports: ["DiscoveryPreview"]
    - path: "src/components/discovery/InitiativeItem.tsx"
      provides: "Single initiative display with status mapping"
      exports: ["InitiativeItem"]
    - path: "src/components/discovery/ColumnGroup.tsx"
      provides: "Column grouping container"
      exports: ["ColumnGroup"]
    - path: "src/components/discovery/index.ts"
      provides: "Barrel file for discovery components"
      exports: ["DiscoveryPreview", "InitiativeItem", "ColumnGroup"]
  key_links:
    - from: "src/components/discovery/DiscoveryPreview.tsx"
      to: "src/lib/discovery/types.ts"
      via: "Uses DiscoveryResult type"
      pattern: "DiscoveryResult|DiscoveredInitiative"
---

<objective>
Create the preview UI components for displaying discovery results.

Purpose: Let users see what will be imported before confirming, with initiatives grouped by target Kanban column and ambiguous mappings highlighted for review.

Output: React components for rendering discovery preview with column-based grouping.
</objective>

<execution_context>
@/Users/tylersahagun/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tylersahagun/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-structure-discovery-a-workspace-population/02-CONTEXT.md

# UI patterns from Phase 1
@src/components/onboarding/OnboardingStepWrapper.tsx (step layout patterns)
@src/components/ui/button.tsx (if exists, for button styling)

# Types to use
@src/lib/discovery/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create InitiativeItem component</name>
  <files>src/components/discovery/InitiativeItem.tsx</files>
  <action>
Create component to display a single discovered initiative.

Implementation:

```typescript
"use client";

import { AlertTriangle, Check, ChevronRight, Folder } from "lucide-react";
import type { DiscoveredInitiative } from "@/lib/discovery/types";

interface InitiativeItemProps {
  initiative: DiscoveredInitiative;
  showCheckbox?: boolean;
  checked?: boolean;
  onToggle?: (id: string) => void;
}

export function InitiativeItem({
  initiative,
  showCheckbox = false,
  checked = false,
  onToggle
}: InitiativeItemProps) {
  const { name, sourcePath, mappedColumn, isStatusAmbiguous, status, archived } = initiative;

  return (
    <div className={`
      flex items-center gap-3 p-3 rounded-lg border
      ${archived ? 'opacity-60 bg-muted/30' : 'bg-card'}
      ${isStatusAmbiguous ? 'border-yellow-500/50' : 'border-border'}
    `}>
      {/* Checkbox for selection */}
      {showCheckbox && (
        <input
          type="checkbox"
          checked={checked}
          onChange={() => onToggle?.(initiative.id)}
          className="h-4 w-4 rounded border-gray-300"
        />
      )}

      {/* Folder icon */}
      <Folder className="h-4 w-4 text-muted-foreground flex-shrink-0" />

      {/* Main content */}
      <div className="flex-1 min-w-0">
        <div className="flex items-center gap-2">
          <span className="font-medium truncate">{name}</span>
          {archived && (
            <span className="text-xs px-1.5 py-0.5 rounded bg-muted text-muted-foreground">
              Archived
            </span>
          )}
        </div>
        <div className="text-sm text-muted-foreground truncate">
          {sourcePath}
        </div>
      </div>

      {/* Arrow */}
      <ChevronRight className="h-4 w-4 text-muted-foreground flex-shrink-0" />

      {/* Mapped column */}
      <div className="flex items-center gap-2">
        <span className={`
          text-sm font-medium px-2 py-1 rounded
          ${isStatusAmbiguous
            ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200'
            : 'bg-primary/10 text-primary'
          }
        `}>
          {mappedColumn}
        </span>

        {/* Ambiguous warning icon */}
        {isStatusAmbiguous && (
          <AlertTriangle className="h-4 w-4 text-yellow-500" title="Status mapping may need review" />
        )}
      </div>
    </div>
  );
}
```

Per CONTEXT.md decisions:
- "Standard level - show name, source path, and mapped status/column"
- "Ambiguous status mappings should be visually distinct"
  </action>
  <verify>
Component renders without errors:
- Check TypeScript compiles: `npx tsc --noEmit`
- Verify imports resolve correctly
  </verify>
  <done>InitiativeItem displays name, path, and mapped column with ambiguity highlighting</done>
</task>

<task type="auto">
  <name>Task 2: Create ColumnGroup component</name>
  <files>src/components/discovery/ColumnGroup.tsx</files>
  <action>
Create component to group initiatives by target column.

Implementation:

```typescript
"use client";

import { Plus } from "lucide-react";
import { InitiativeItem } from "./InitiativeItem";
import type { DiscoveredInitiative } from "@/lib/discovery/types";

interface ColumnGroupProps {
  column: string;
  isDynamic: boolean;  // Column doesn't exist yet, will be created
  initiatives: DiscoveredInitiative[];
  showCheckboxes?: boolean;
  selectedIds?: Set<string>;
  onToggle?: (id: string) => void;
}

export function ColumnGroup({
  column,
  isDynamic,
  initiatives,
  showCheckboxes = false,
  selectedIds = new Set(),
  onToggle
}: ColumnGroupProps) {
  if (initiatives.length === 0) return null;

  return (
    <div className="space-y-3">
      {/* Column header */}
      <div className="flex items-center gap-2">
        <h3 className="font-semibold text-lg capitalize">{column}</h3>
        <span className="text-sm text-muted-foreground">
          ({initiatives.length} {initiatives.length === 1 ? 'project' : 'projects'})
        </span>
        {isDynamic && (
          <span className="flex items-center gap-1 text-xs px-2 py-0.5 rounded-full bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300">
            <Plus className="h-3 w-3" />
            New column
          </span>
        )}
      </div>

      {/* Initiative list */}
      <div className="space-y-2">
        {initiatives.map((initiative) => (
          <InitiativeItem
            key={initiative.id}
            initiative={initiative}
            showCheckbox={showCheckboxes}
            checked={selectedIds.has(initiative.id)}
            onToggle={onToggle}
          />
        ))}
      </div>
    </div>
  );
}
```

Per CONTEXT.md: "Group discovered items by target column (Discovery, Development, etc.) rather than by source folder"
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>ColumnGroup displays initiatives grouped by target Kanban column with dynamic column indicator</done>
</task>

<task type="auto">
  <name>Task 3: Create DiscoveryPreview container component</name>
  <files>src/components/discovery/DiscoveryPreview.tsx, src/components/discovery/index.ts</files>
  <action>
Create main preview container that orchestrates the display.

Implementation for DiscoveryPreview.tsx:

```typescript
"use client";

import { useMemo } from "react";
import { ColumnGroup } from "./ColumnGroup";
import type { DiscoveryResult, DiscoveredInitiative, PreviewGroup } from "@/lib/discovery/types";

interface DiscoveryPreviewProps {
  result: DiscoveryResult;
  selectedIds?: Set<string>;
  onToggleInitiative?: (id: string) => void;
  showCheckboxes?: boolean;
}

// Known column order for consistent display
const COLUMN_ORDER = [
  'inbox', 'discovery', 'prd', 'design', 'prototype',
  'validate', 'tickets', 'build', 'alpha', 'beta', 'ga'
];

export function DiscoveryPreview({
  result,
  selectedIds = new Set(),
  onToggleInitiative,
  showCheckboxes = false
}: DiscoveryPreviewProps) {
  // Group initiatives by target column
  const groups = useMemo(() => {
    const groupMap = new Map<string, DiscoveredInitiative[]>();

    // Group by mappedColumn
    result.initiatives.forEach((initiative) => {
      const column = initiative.mappedColumn;
      if (!groupMap.has(column)) {
        groupMap.set(column, []);
      }
      groupMap.get(column)!.push(initiative);
    });

    // Convert to array and sort
    const groups: PreviewGroup[] = [];
    const knownColumns = new Set(COLUMN_ORDER);

    // First add known columns in order
    COLUMN_ORDER.forEach((column) => {
      if (groupMap.has(column)) {
        groups.push({
          column,
          isDynamic: false,
          initiatives: groupMap.get(column)!
        });
        groupMap.delete(column);
      }
    });

    // Then add dynamic columns (alphabetically)
    const dynamicColumns = Array.from(groupMap.keys()).sort();
    dynamicColumns.forEach((column) => {
      groups.push({
        column,
        isDynamic: true,
        initiatives: groupMap.get(column)!
      });
    });

    return groups;
  }, [result.initiatives]);

  if (result.initiatives.length === 0) {
    return (
      <div className="text-center py-8">
        <p className="text-muted-foreground">
          No initiatives found in the repository.
        </p>
        <p className="text-sm text-muted-foreground mt-2">
          Try selecting a different branch or checking the repository structure.
        </p>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Context paths summary (if found) */}
      {result.contextPaths.length > 0 && (
        <div className="p-4 rounded-lg bg-muted/30 border">
          <h4 className="font-medium mb-2">Context Paths Detected</h4>
          <div className="flex flex-wrap gap-2">
            {result.contextPaths.map((cp) => (
              <span
                key={cp.path}
                className="text-sm px-2 py-1 rounded bg-primary/10 text-primary"
              >
                {cp.type}: {cp.path}
              </span>
            ))}
          </div>
        </div>
      )}

      {/* Agents summary (if found) */}
      {result.agents.length > 0 && (
        <div className="p-4 rounded-lg bg-muted/30 border">
          <h4 className="font-medium mb-2">Agents Detected</h4>
          <p className="text-sm text-muted-foreground">
            {result.agents.length} agent definition(s) found
          </p>
        </div>
      )}

      {/* Column groups */}
      {groups.map((group) => (
        <ColumnGroup
          key={group.column}
          column={group.column}
          isDynamic={group.isDynamic}
          initiatives={group.initiatives}
          showCheckboxes={showCheckboxes}
          selectedIds={selectedIds}
          onToggle={onToggleInitiative}
        />
      ))}

      {/* Warnings */}
      {result.warnings.length > 0 && (
        <div className="p-4 rounded-lg bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800">
          <h4 className="font-medium text-yellow-800 dark:text-yellow-200 mb-2">
            Warnings ({result.warnings.length})
          </h4>
          <ul className="text-sm text-yellow-700 dark:text-yellow-300 space-y-1">
            {result.warnings.map((warning, i) => (
              <li key={i}>{warning.path}: {warning.message}</li>
            ))}
          </ul>
        </div>
      )}
    </div>
  );
}
```

Create barrel file src/components/discovery/index.ts:
```typescript
export { DiscoveryPreview } from './DiscoveryPreview';
export { InitiativeItem } from './InitiativeItem';
export { ColumnGroup } from './ColumnGroup';
```
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Barrel file exports all components
  </verify>
  <done>DiscoveryPreview renders full preview with column grouping, context paths, agents, and warnings</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. TypeScript compiles: `npx tsc --noEmit`
2. All components export from barrel file
3. Components use proper types from discovery module
</verification>

<success_criteria>
- Initiatives displayed grouped by target column (PREV-01, PREV-02)
- Each item shows name, source path, and mapped column
- Ambiguous mappings highlighted with warning icon
- Dynamic columns indicated with "New column" badge
- Context paths and agents summarized
- Warnings displayed if any
</success_criteria>

<output>
After completion, create `.planning/phases/02-structure-discovery-a-workspace-population/02-04-SUMMARY.md`
</output>
