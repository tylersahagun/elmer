---
phase: 02-structure-discovery-a-workspace-population
plan: 06
type: execute
wave: 3
depends_on: ["02-03", "02-04"]
files_modified:
  - src/components/discovery/ValidationSummary.tsx
  - src/components/discovery/ConfirmationScreen.tsx
autonomous: true

must_haves:
  truths:
    - "User sees validation summary with import counts before confirming"
    - "User reviews confirmation screen before workspace is populated"
    - "Skip import option available as subtle link"
  artifacts:
    - path: "src/components/discovery/ValidationSummary.tsx"
      provides: "Import summary with counts"
      exports: ["ValidationSummary"]
    - path: "src/components/discovery/ConfirmationScreen.tsx"
      provides: "Final confirmation before import"
      exports: ["ConfirmationScreen"]
  key_links:
    - from: "src/components/discovery/ConfirmationScreen.tsx"
      to: "src/lib/stores/discovery-store.ts"
      via: "Uses store for selection counts"
      pattern: "useDiscoveryStore"
---

<objective>
Create validation summary and confirmation components.

Purpose: Give users a clear overview of what will be imported before they commit, with the option to skip if they prefer manual configuration.

Output: Summary component showing import counts and confirmation screen with final review.
</objective>

<execution_context>
@/Users/tylersahagun/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tylersahagun/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-structure-discovery-a-workspace-population/02-CONTEXT.md

# Store for selection state
@src/lib/stores/discovery-store.ts

# Prior plan outputs
@.planning/phases/02-structure-discovery-a-workspace-population/02-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ValidationSummary component</name>
  <files>src/components/discovery/ValidationSummary.tsx</files>
  <action>
Create summary component showing what will be imported.

Implementation:

```typescript
"use client";

import { Package, FileText, Users, Radio, Bot, AlertTriangle, Columns } from "lucide-react";
import { useDiscoveryStore } from "@/lib/stores/discovery-store";
import { useMemo } from "react";

export function ValidationSummary() {
  const {
    result,
    selectedInitiatives,
    selectedContextPaths,
    selectedAgents
  } = useDiscoveryStore();

  const summary = useMemo(() => {
    if (!result) return null;

    // Count selected items
    const projects = selectedInitiatives.size;

    // Count context path types
    let knowledge = 0;
    let personas = 0;
    let signals = 0;

    result.contextPaths.forEach((cp) => {
      if (selectedContextPaths.has(cp.path)) {
        if (cp.type === 'knowledge') knowledge += cp.fileCount;
        if (cp.type === 'personas') personas += cp.fileCount;
        if (cp.type === 'signals') signals += cp.fileCount;
      }
    });

    // Count agents
    const agents = result.agents.filter(a => selectedAgents.has(a.path)).length;

    // Count dynamic columns that will be created
    const existingColumns = new Set([
      'inbox', 'discovery', 'prd', 'design', 'prototype',
      'validate', 'tickets', 'build', 'alpha', 'beta', 'ga'
    ]);
    const dynamicColumns = new Set<string>();

    result.initiatives.forEach((initiative) => {
      if (selectedInitiatives.has(initiative.id)) {
        if (!existingColumns.has(initiative.mappedColumn)) {
          dynamicColumns.add(initiative.mappedColumn);
        }
      }
    });

    // Count ambiguous mappings
    const ambiguous = result.initiatives.filter(
      i => selectedInitiatives.has(i.id) && i.isStatusAmbiguous
    ).length;

    return {
      projects,
      knowledge,
      personas,
      signals,
      agents,
      dynamicColumns: Array.from(dynamicColumns),
      ambiguous
    };
  }, [result, selectedInitiatives, selectedContextPaths, selectedAgents]);

  if (!summary) return null;

  // Per CONTEXT.md: "Display summary at top of preview"
  return (
    <div className="p-4 rounded-lg bg-gradient-to-r from-primary/5 to-primary/10 border border-primary/20">
      <h3 className="font-semibold mb-3">Import Summary</h3>

      <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4">
        {/* Projects */}
        <div className="flex items-center gap-2">
          <Package className="h-5 w-5 text-primary" />
          <div>
            <div className="text-lg font-bold">{summary.projects}</div>
            <div className="text-xs text-muted-foreground">
              {summary.projects === 1 ? 'project' : 'projects'}
            </div>
          </div>
        </div>

        {/* Knowledge docs */}
        {summary.knowledge > 0 && (
          <div className="flex items-center gap-2">
            <FileText className="h-5 w-5 text-blue-500" />
            <div>
              <div className="text-lg font-bold">{summary.knowledge}</div>
              <div className="text-xs text-muted-foreground">knowledge docs</div>
            </div>
          </div>
        )}

        {/* Personas */}
        {summary.personas > 0 && (
          <div className="flex items-center gap-2">
            <Users className="h-5 w-5 text-green-500" />
            <div>
              <div className="text-lg font-bold">{summary.personas}</div>
              <div className="text-xs text-muted-foreground">
                {summary.personas === 1 ? 'persona' : 'personas'}
              </div>
            </div>
          </div>
        )}

        {/* Signals */}
        {summary.signals > 0 && (
          <div className="flex items-center gap-2">
            <Radio className="h-5 w-5 text-orange-500" />
            <div>
              <div className="text-lg font-bold">{summary.signals}</div>
              <div className="text-xs text-muted-foreground">
                {summary.signals === 1 ? 'signal' : 'signals'}
              </div>
            </div>
          </div>
        )}

        {/* Agents */}
        {summary.agents > 0 && (
          <div className="flex items-center gap-2">
            <Bot className="h-5 w-5 text-purple-500" />
            <div>
              <div className="text-lg font-bold">{summary.agents}</div>
              <div className="text-xs text-muted-foreground">
                {summary.agents === 1 ? 'agent' : 'agents'}
              </div>
            </div>
          </div>
        )}

        {/* Dynamic columns */}
        {summary.dynamicColumns.length > 0 && (
          <div className="flex items-center gap-2">
            <Columns className="h-5 w-5 text-teal-500" />
            <div>
              <div className="text-lg font-bold">{summary.dynamicColumns.length}</div>
              <div className="text-xs text-muted-foreground">new columns</div>
            </div>
          </div>
        )}
      </div>

      {/* Ambiguous warning */}
      {summary.ambiguous > 0 && (
        <div className="mt-3 flex items-center gap-2 text-sm text-yellow-600 dark:text-yellow-400">
          <AlertTriangle className="h-4 w-4" />
          <span>
            {summary.ambiguous} item{summary.ambiguous === 1 ? ' has' : 's have'} ambiguous
            status mapping - review recommended
          </span>
        </div>
      )}

      {/* Dynamic columns list */}
      {summary.dynamicColumns.length > 0 && (
        <div className="mt-3 text-sm text-muted-foreground">
          New columns to create: {summary.dynamicColumns.join(', ')}
        </div>
      )}
    </div>
  );
}
```
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>ValidationSummary displays import counts for projects, docs, personas, signals, agents</done>
</task>

<task type="auto">
  <name>Task 2: Create ConfirmationScreen component</name>
  <files>src/components/discovery/ConfirmationScreen.tsx</files>
  <action>
Create confirmation screen for final review before import.

Implementation:

```typescript
"use client";

import { ArrowRight, SkipForward } from "lucide-react";
import { ValidationSummary } from "./ValidationSummary";
import { useDiscoveryStore } from "@/lib/stores/discovery-store";

interface ConfirmationScreenProps {
  onConfirm: () => void;
  onSkip: () => void;
  isImporting?: boolean;
}

export function ConfirmationScreen({
  onConfirm,
  onSkip,
  isImporting = false
}: ConfirmationScreenProps) {
  const { selectedInitiatives, result } = useDiscoveryStore();

  const hasSelections = selectedInitiatives.size > 0;

  return (
    <div className="space-y-6">
      {/* Summary at top per CONTEXT.md */}
      <ValidationSummary />

      {/* Confirmation message */}
      <div className="text-center space-y-4">
        {hasSelections ? (
          <>
            <h3 className="text-xl font-semibold">
              Ready to populate your workspace
            </h3>
            <p className="text-muted-foreground max-w-md mx-auto">
              The selected items will be imported into your Elmer workspace.
              Projects will be placed in their corresponding Kanban columns based
              on the status mapping.
            </p>
          </>
        ) : (
          <>
            <h3 className="text-xl font-semibold text-muted-foreground">
              No items selected
            </h3>
            <p className="text-muted-foreground max-w-md mx-auto">
              Select at least one item to import, or skip to configure manually.
            </p>
          </>
        )}
      </div>

      {/* Action buttons */}
      <div className="flex flex-col items-center gap-4">
        {/* Primary action */}
        <button
          onClick={onConfirm}
          disabled={!hasSelections || isImporting}
          className={`
            flex items-center gap-2 px-6 py-3 rounded-lg font-medium
            transition-colors
            ${hasSelections && !isImporting
              ? 'bg-primary text-primary-foreground hover:bg-primary/90'
              : 'bg-muted text-muted-foreground cursor-not-allowed'
            }
          `}
        >
          {isImporting ? (
            <>
              <span className="animate-spin">‚è≥</span>
              Importing...
            </>
          ) : (
            <>
              Import Selected
              <ArrowRight className="h-4 w-4" />
            </>
          )}
        </button>

        {/* Skip link - per CONTEXT.md: "subtle link, not prominent button" */}
        <button
          onClick={onSkip}
          disabled={isImporting}
          className="text-sm text-muted-foreground hover:text-foreground underline-offset-4 hover:underline"
        >
          Skip import, configure manually later
        </button>
      </div>

      {/* Re-onboarding warning if applicable */}
      {result?.stats && result.stats.initiativesFound > 0 && (
        <div className="text-center text-xs text-muted-foreground">
          Re-running import will update existing projects, not create duplicates.
        </div>
      )}
    </div>
  );
}
```

Update barrel file:
```typescript
export { DiscoveryPreview } from './DiscoveryPreview';
export { InitiativeItem } from './InitiativeItem';
export { ColumnGroup } from './ColumnGroup';
export { SelectionControls } from './SelectionControls';
export { FilterBar } from './FilterBar';
export { ValidationSummary } from './ValidationSummary';
export { ConfirmationScreen } from './ConfirmationScreen';
```
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Barrel file updated
  </verify>
  <done>ConfirmationScreen provides final review with confirm and skip options</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. TypeScript compiles: `npx tsc --noEmit`
2. All components export from barrel file
3. ValidationSummary shows counts matching CONTEXT.md format
</verification>

<success_criteria>
- Summary shows "This will create X projects, sync Y knowledge docs, import Z personas" (PREV-03)
- User can review before confirming (PREV-05)
- Skip import option available but subtle (IMPRT-05)
- Summary displayed at top of preview per CONTEXT.md
</success_criteria>

<output>
After completion, create `.planning/phases/02-structure-discovery-a-workspace-population/02-06-SUMMARY.md`
</output>
