---
phase: 01-onboarding-foundation-a-repository-connection
plan: 04
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/components/onboarding/tour/TourProvider.tsx
  - src/components/onboarding/tour/TourStep.tsx
  - src/components/onboarding/tour/TourSpotlight.tsx
  - src/components/onboarding/tour/tour-steps.ts
  - src/components/onboarding/tour/index.ts
  - src/lib/stores/tour-store.ts

autonomous: true

must_haves:
  truths:
    - "After onboarding completes, user sees optional 'Take a Tour' prompt"
    - "Tour shows how components work together (projects, knowledge base, personas, signals, agents)"
    - "Tour shows where work is created (GitHub repo paths)"
    - "User can skip tour or dismiss individual tour steps"
    - "User can restart tour from help menu"
  artifacts:
    - path: "src/components/onboarding/tour/TourProvider.tsx"
      provides: "React context provider that manages tour state and rendering"
      exports: ["TourProvider", "useTour"]
    - path: "src/components/onboarding/tour/TourSpotlight.tsx"
      provides: "Spotlight overlay component that highlights areas with auto-advance"
      exports: ["TourSpotlight"]
    - path: "src/components/onboarding/tour/tour-steps.ts"
      provides: "Tour step definitions with targets and content"
      exports: ["tourSteps", "TourStepDefinition"]
    - path: "src/lib/stores/tour-store.ts"
      provides: "Zustand store for tour state with localStorage persistence"
      exports: ["useTourStore"]
  key_links:
    - from: "src/components/onboarding/tour/TourProvider.tsx"
      to: "src/lib/stores/tour-store.ts"
      via: "useTourStore for completion tracking"
      pattern: "useTourStore\\(\\)"
    - from: "src/components/onboarding/tour/TourSpotlight.tsx"
      to: "tour-steps.ts"
      via: "step definitions for positioning and content"
      pattern: "tourSteps"
    - from: "src/lib/stores/tour-store.ts"
      to: "src/components/onboarding/OnboardingWizard.tsx"
      via: "showPrompt() called from wizard completion (implemented in Plan 05)"
      pattern: "showPrompt"
---

<objective>
Create the post-onboarding tour system including tour state management, spotlight components, step definitions, and dismissal/restart functionality.

Purpose: Implement TOUR-01 (optional tour prompt), TOUR-02 (show how components work together), TOUR-03 (show where work is created), TOUR-04 (skip/dismiss functionality), and TOUR-05 (restart from help menu).

Output: Complete tour infrastructure that can be triggered after onboarding and restarted from help menu.
</objective>

<execution_context>
@/Users/tylersahagun/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tylersahagun/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-onboarding-foundation-a-repository-connection/01-CONTEXT.md

# From Plan 01 - wizard foundation
@src/lib/stores/onboarding-store.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Tour State Store</name>
  <files>src/lib/stores/tour-store.ts</files>
  <action>
Create a Zustand store for tour state with localStorage persistence (persists across sessions, unlike onboarding which uses sessionStorage).

**Store shape:**
```typescript
interface TourState {
  // Tour progress
  hasSeenTour: boolean;
  currentStep: number | null;  // null = tour not active
  completedSteps: number[];

  // Prompt state
  hasDeclinedTour: boolean;
  showTourPrompt: boolean;

  // Actions
  startTour: () => void;
  nextStep: () => void;
  previousStep: () => void;
  skipStep: () => void;
  endTour: () => void;
  dismissPrompt: (declined: boolean) => void;
  restartTour: () => void;
  showPrompt: () => void;
}
```

**Requirements:**
- Use Zustand persist middleware with localStorage (tour completion should persist)
- `restartTour()` resets completedSteps and currentStep but keeps hasSeenTour true
- `endTour()` marks hasSeenTour true and sets currentStep to null
- `dismissPrompt(true)` sets hasDeclinedTour, `dismissPrompt(false)` just hides prompt
- Store should track which steps user has seen for analytics potential
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles without errors.
  </verify>
  <done>
Tour store exports useTourStore hook with tour state and actions. Persists to localStorage. Supports start, navigation, skip, end, and restart flows.
  </done>
</task>

<task type="auto">
  <name>Task 2: Define Tour Steps Configuration</name>
  <files>src/components/onboarding/tour/tour-steps.ts</files>
  <action>
Define the tour step configurations including targets, content, and timing.

**Step definition type:**
```typescript
interface TourStepDefinition {
  id: string;
  target: string;  // CSS selector or element ID
  title: string;
  content: string;
  placement: 'top' | 'bottom' | 'left' | 'right' | 'center';
  example?: string;  // From CONTEXT.md: "Moderate depth with examples"
  autoAdvanceMs?: number;  // From CONTEXT.md: "auto-advance after time"
  optional?: boolean;  // Can be skipped
}
```

**Tour steps to define (from TOUR-02, TOUR-03):**

1. **Welcome** (center, no target)
   - "Welcome to your workspace!"
   - Brief intro, what was imported

2. **Projects/Kanban** (target: kanban board area)
   - "Your projects flow through stages"
   - Example: "Drag a project to 'PRD' to start generating documentation"

3. **Knowledge Base** (target: knowledge nav item or panel)
   - "Your knowledge base syncs from GitHub"
   - Example: "These docs inform all AI-generated content"

4. **Personas** (target: personas nav item)
   - "Personas represent your users"
   - Example: "Attach personas to projects for targeted PRDs"

5. **Signals** (target: signals nav item)
   - "Signals capture customer feedback"
   - Example: "Cluster similar signals to identify patterns"

6. **Agents** (target: commands/agents nav item)
   - "Agents automate your workflow"
   - Example: "Run an agent to generate a PRD from a project"

7. **GitHub Integration** (target: settings or repo indicator)
   - "All work syncs back to GitHub"
   - Show where generated files appear

**Timing from CONTEXT.md:**
- Auto-advance: 8-10 seconds per step (configurable)
- User can manually advance anytime
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles. Verify all step IDs are unique.
  </verify>
  <done>
tour-steps.ts exports tourSteps array with all step definitions and TourStepDefinition type.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Tour Components</name>
  <files>
    src/components/onboarding/tour/TourProvider.tsx
    src/components/onboarding/tour/TourStep.tsx
    src/components/onboarding/tour/TourSpotlight.tsx
    src/components/onboarding/tour/index.ts
  </files>
  <action>
Create the tour UI components including provider, spotlight, and step content.

**TourProvider:**
- Wraps application to enable tour functionality
- Provides useTour() hook for accessing tour state and actions
- Renders TourSpotlight when tour is active
- Renders tour prompt modal when showTourPrompt is true

**Tour Prompt (in TourProvider):**
- Modal/dialog that appears after onboarding: "Take a Tour?"
- "See how everything works together in 2 minutes"
- Buttons: "Start Tour" (primary), "Maybe Later" (dismiss), X button (subtle, from CONTEXT.md)
- "Maybe Later" hides prompt but doesn't permanently decline
- X button permanently dismisses (sets hasDeclinedTour)

**TourSpotlight:**
- Overlay that darkens screen except for highlighted target element
- Finds target element via CSS selector from step definition
- Positions spotlight around target with padding
- Uses Framer Motion for smooth transitions between targets
- Auto-advances after autoAdvanceMs (show progress indicator)
- User can click anywhere on overlay to advance

**TourStep (content component):**
- Displays step title, content, and example
- Navigation: Previous, Next/Finish, Skip (from CONTEXT.md: can skip individual steps)
- Step indicator: "Step 3 of 7"
- Positioned relative to spotlight based on placement

**Index barrel:**
Export TourProvider, useTour, TourSpotlight, TourStep, tourSteps, types.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles. Verify index exports all expected symbols.
  </verify>
  <done>
TourProvider manages tour lifecycle and renders prompt/spotlight. TourSpotlight highlights elements with smooth transitions. TourStep shows content with navigation. All components exported from index.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npx tsc --noEmit` passes without errors
2. All tour component files exist at specified paths
3. `grep -l "useTourStore" src/components/onboarding/tour/TourProvider.tsx` confirms store integration
4. `grep "tourSteps" src/components/onboarding/tour/tour-steps.ts` shows step array export
5. Index file exports TourProvider, useTour, tourSteps
</verification>

<success_criteria>
- Tour store persists completion state to localStorage
- Tour steps define targets for kanban, knowledge base, personas, signals, agents, GitHub
- TourProvider can be wrapped around app to enable tour functionality
- Tour prompt appears with Start/Maybe Later/X options
- TourSpotlight highlights elements with auto-advance and manual navigation
- Tour can be restarted (store.restartTour()) for help menu integration
</success_criteria>

<output>
After completion, create `.planning/phases/01-onboarding-foundation-a-repository-connection/01-04-SUMMARY.md`
</output>
