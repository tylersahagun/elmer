---
phase: 01-onboarding-foundation-a-repository-connection
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/stores/onboarding-store.ts
  - src/components/onboarding/OnboardingProgress.tsx
  - src/components/onboarding/OnboardingStepWrapper.tsx
  - src/components/onboarding/OnboardingErrorBoundary.tsx
  - src/components/onboarding/index.ts

autonomous: true

must_haves:
  truths:
    - "User sees progress indicator showing current step number and completion percentage"
    - "User can navigate backward to previous steps to revise choices"
    - "User can skip optional steps with 'I'll do this later' button"
    - "Wizard state persists across page refreshes during onboarding session"
    - "User sees friendly error messages with expandable technical details and retry buttons"
  artifacts:
    - path: "src/lib/stores/onboarding-store.ts"
      provides: "Zustand store with sessionStorage persistence for wizard state"
      exports: ["useOnboardingStore", "OnboardingStep", "OnboardingState"]
    - path: "src/components/onboarding/OnboardingProgress.tsx"
      provides: "Progress bar with step indicator and percentage"
      exports: ["OnboardingProgress"]
    - path: "src/components/onboarding/OnboardingStepWrapper.tsx"
      provides: "Step container with navigation buttons and skip functionality"
      exports: ["OnboardingStepWrapper"]
    - path: "src/components/onboarding/OnboardingErrorBoundary.tsx"
      provides: "Error display with retry capability"
      exports: ["OnboardingErrorBoundary"]
  key_links:
    - from: "src/components/onboarding/OnboardingStepWrapper.tsx"
      to: "src/lib/stores/onboarding-store.ts"
      via: "useOnboardingStore hook for step navigation"
      pattern: "useOnboardingStore\\(\\)"
    - from: "src/components/onboarding/OnboardingProgress.tsx"
      to: "src/lib/stores/onboarding-store.ts"
      via: "useOnboardingStore hook for current step and progress"
      pattern: "useOnboardingStore\\(\\)"
---

<objective>
Create the foundational wizard infrastructure including state management with persistence, progress visualization, step navigation with back/skip capabilities, and error handling with retry functionality.

Purpose: Establish the core wizard patterns that all subsequent onboarding steps will use. This is the foundation that enables session persistence (FOUND-05), progress tracking (FOUND-01), skip functionality (FOUND-02), and error recovery (FOUND-03).

Output: Reusable wizard components and Zustand store that can wrap any step content.
</objective>

<execution_context>
@/Users/tylersahagun/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tylersahagun/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-onboarding-foundation-a-repository-connection/01-CONTEXT.md

# Existing patterns to follow
@src/lib/utils.ts
@src/components/ui/button.tsx
@src/components/ui/progress.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Onboarding Zustand Store with Session Persistence</name>
  <files>src/lib/stores/onboarding-store.ts</files>
  <action>
Create a Zustand store for onboarding wizard state with sessionStorage persistence.

**Store shape:**
```typescript
interface OnboardingState {
  // Step tracking
  currentStep: OnboardingStep;
  completedSteps: OnboardingStep[];
  skippedSteps: OnboardingStep[];

  // Repository data (populated by repo step)
  selectedRepo: GitHubRepo | null;
  selectedBranch: string | null;

  // Error state
  lastError: OnboardingError | null;

  // Session tracking
  startedAt: string | null;
  lastUpdatedAt: string | null;

  // Actions
  setStep: (step: OnboardingStep) => void;
  completeStep: (step: OnboardingStep) => void;
  skipStep: (step: OnboardingStep) => void;
  goBack: () => void;
  setRepo: (repo: GitHubRepo, branch: string) => void;
  setError: (error: OnboardingError | null) => void;
  reset: () => void;
  getProgress: () => { current: number; total: number; percentage: number };
}

type OnboardingStep = 'welcome' | 'connect-github' | 'select-repo' | 'configure' | 'complete';
```

**Requirements:**
- Use Zustand's persist middleware with sessionStorage (not localStorage) so state clears when browser closes
- Include `partialize` to exclude error state from persistence
- Store should handle resumption: if user refreshes, they return to currentStep
- Export types for OnboardingStep and OnboardingState for use in components
- Follow existing store patterns in codebase (check src/lib/stores/ if exists, else follow standard Zustand patterns)

**Import:**
```typescript
import { create } from 'zustand';
import { persist, createJSONStorage } from 'zustand/middleware';
```
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles without errors.
  </verify>
  <done>
Store exports useOnboardingStore hook with all state fields and actions. Store persists to sessionStorage and correctly restores state on page refresh.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Progress Indicator Component</name>
  <files>src/components/onboarding/OnboardingProgress.tsx</files>
  <action>
Create a progress indicator showing current step and completion percentage.

**Component requirements:**
- Display step indicator: "Step 2 of 4: Select Repository"
- Display progress bar with percentage (use existing Progress component from @/components/ui/progress)
- Show completed steps with checkmarks, current step highlighted, future steps grayed
- Animate progress bar changes using Framer Motion (motion library already in project)
- Support skipped steps visually (different indicator from completed)

**Layout from CONTEXT.md decision:**
- Progress bar with percentage indicator (visual completion tracking)
- Linear progression display

**Props interface:**
```typescript
interface OnboardingProgressProps {
  steps: { id: OnboardingStep; label: string; optional?: boolean }[];
  className?: string;
}
```

**Styling:**
- Use Tailwind classes following existing component patterns
- Use cn() utility for conditional classes
- Icons from lucide-react (Check, Circle, CircleDot for states)
  </action>
  <verify>
Create a simple test: import the component and verify it renders with mock steps array without throwing errors.
  </verify>
  <done>
OnboardingProgress component renders step indicator with percentage, shows visual distinction between completed/current/future/skipped steps, and animates progress changes.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Step Wrapper with Navigation and Error Boundary</name>
  <files>
    src/components/onboarding/OnboardingStepWrapper.tsx
    src/components/onboarding/OnboardingErrorBoundary.tsx
    src/components/onboarding/index.ts
  </files>
  <action>
Create the step wrapper component that provides navigation buttons and wraps step content, plus an error boundary for graceful error handling.

**OnboardingStepWrapper requirements:**
- Wrap children (step content) with consistent layout
- Navigation buttons: Back (if not first step), Next/Continue (primary), Skip (if step is optional)
- Back button calls store.goBack()
- Skip button calls store.skipStep(currentStep) and advances
- Next button disabled until step is valid (via onValidate prop)
- Show loading state on Next button during async operations
- Handle "Resume" prompt from CONTEXT.md: On mount, if store has existing progress, show toast "You were on step X. Continue?"

**Props interface:**
```typescript
interface OnboardingStepWrapperProps {
  step: OnboardingStep;
  title: string;
  description?: string;
  optional?: boolean;
  onNext: () => Promise<void> | void;
  onValidate?: () => boolean;
  children: React.ReactNode;
  isLoading?: boolean;
}
```

**OnboardingErrorBoundary requirements:**
- Catch errors in step content
- Display friendly message with expandable technical details (from CONTEXT.md: "Hybrid tone: Friendly message + expandable technical details")
- Retry button that calls store.setError(null) and re-renders
- Auto-retry once on first failure, then show manual retry (from CONTEXT.md)
- Use Collapsible component from Radix for expandable details

**Barrel file (index.ts):**
Export all components: OnboardingProgress, OnboardingStepWrapper, OnboardingErrorBoundary, and re-export store hook/types.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles. Verify index.ts exports all expected symbols.
  </verify>
  <done>
OnboardingStepWrapper renders with navigation buttons (Back/Next/Skip based on step position and optional flag). OnboardingErrorBoundary catches errors and shows friendly message with expandable details and retry button. Index barrel exports all components and store.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npx tsc --noEmit` passes without errors
2. All files exist at specified paths
3. `grep -l "useOnboardingStore" src/components/onboarding/*.tsx` returns OnboardingProgress.tsx and OnboardingStepWrapper.tsx (confirming store integration)
4. `grep "export" src/components/onboarding/index.ts` shows all expected exports
</verification>

<success_criteria>
- Zustand store persists wizard state to sessionStorage and survives page refresh
- Progress component shows step number, label, and percentage with visual step indicators
- Step wrapper provides Back/Next/Skip navigation based on step configuration
- Error boundary catches errors and provides retry functionality with friendly messaging
- All components follow existing codebase patterns (Tailwind, cn utility, lucide-react icons)
</success_criteria>

<output>
After completion, create `.planning/phases/01-onboarding-foundation-a-repository-connection/01-01-SUMMARY.md`
</output>
