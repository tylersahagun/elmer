---
phase: 01-onboarding-foundation-a-repository-connection
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(dashboard)/workspace/[id]/settings/page.tsx
  - src/components/settings/RepositorySettingsCard.tsx
  - src/components/settings/ContextPathsCard.tsx
  - src/components/settings/OnboardingStatusCard.tsx

autonomous: true

must_haves:
  truths:
    - "Settings page no longer shows initial setup fields (repo selection, context paths) for first-time configuration"
    - "Settings page becomes edit mode for post-onboarding adjustments"
    - "User can re-run discovery from settings to sync new initiatives"
    - "Settings page maintains existing advanced configuration options"
  artifacts:
    - path: "src/app/(dashboard)/workspace/[id]/settings/page.tsx"
      provides: "Updated settings page routing to onboarding-aware layout"
      contains: "onboardingComplete"
    - path: "src/components/settings/RepositorySettingsCard.tsx"
      provides: "Repository settings in edit mode (not initial setup)"
      contains: "Change Repository"
    - path: "src/components/settings/OnboardingStatusCard.tsx"
      provides: "Card showing onboarding completion status with re-run option"
      exports: ["OnboardingStatusCard"]
  key_links:
    - from: "src/app/(dashboard)/workspace/[id]/settings/page.tsx"
      to: "workspace.onboardingComplete"
      via: "conditional rendering based on workspace status"
      pattern: "onboardingComplete"
    - from: "src/components/settings/OnboardingStatusCard.tsx"
      to: "/api/onboarding/re-discover"
      via: "re-run discovery trigger"
      pattern: "re-discover|resync"
---

<objective>
Refactor the settings page to distinguish between initial onboarding and post-onboarding configuration. Settings should show "edit mode" UI after onboarding completes, not first-time setup fields.

Purpose: Implement SETTNG-01 (remove initial setup from settings), SETTNG-02 (edit mode for adjustments), SETTNG-03 (re-run discovery option), and SETTNG-04 (maintain advanced options).

Output: Updated settings page that behaves differently based on workspace onboarding status.
</objective>

<execution_context>
@/Users/tylersahagun/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tylersahagun/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing settings components to modify
@src/app/(dashboard)/workspace/[id]/settings/page.tsx
@src/components/settings/RepositorySettingsCard.tsx
@src/components/settings/ContextPathsCard.tsx
@src/components/settings/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Onboarding Status Card Component</name>
  <files>src/components/settings/OnboardingStatusCard.tsx</files>
  <action>
Create a card that displays onboarding completion status and provides re-run discovery functionality.

**Component requirements:**
- Show "Onboarding Complete" status with checkmark when workspace has been onboarded
- Display when workspace was onboarded and what was imported (projects count, etc.)
- "Re-sync from GitHub" button to trigger re-discovery
- When re-sync clicked: Call future /api/onboarding/re-discover endpoint (stub for now)
- Show confirmation dialog before re-sync: "This will scan your repository for new initiatives. Existing projects will not be affected."

**Component interface:**
```typescript
interface OnboardingStatusCardProps {
  workspaceId: string;
  onboardedAt?: string;
  projectsImported?: number;
  className?: string;
}
```

**Card content:**
```
Onboarding Status
----------------
[Checkmark] Completed on Jan 25, 2026

Imported: 12 projects, 5 personas, 24 knowledge docs

[Re-sync from GitHub] button
```

**Styling:**
- Use Card component pattern from existing settings cards
- Success color for completed status
- Button is secondary variant (not destructive since re-sync is non-destructive)
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles without errors.
  </verify>
  <done>
OnboardingStatusCard shows completion status, import stats, and re-sync button with confirmation dialog.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Repository Settings Card for Edit Mode</name>
  <files>src/components/settings/RepositorySettingsCard.tsx</files>
  <action>
Modify RepositorySettingsCard to distinguish between initial setup and edit mode.

**Changes needed:**
- Add `mode` prop: 'setup' | 'edit' (default: 'edit')
- In 'edit' mode:
  - Show current repository and branch as read-only display with "Change" button
  - "Change Repository" opens a modal/dialog instead of inline form
  - Include warning in dialog: "Changing repository will affect future syncs"
  - Keep existing Save functionality for when changes are made
- In 'setup' mode (legacy, for backwards compat):
  - Show current inline repo/branch selector behavior
  - This mode will be used by old settings page if needed

**Updated interface:**
```typescript
interface RepositorySettingsCardProps {
  workspace: Workspace;
  mode?: 'setup' | 'edit';
  onSave?: () => void;
}
```

**Edit mode layout:**
```
Repository Connection
--------------------
Connected to: acme/product-repo (main branch)
Last synced: 2 hours ago

[Change Repository] [Sync Now]
```

**Note:** Do NOT remove existing functionality, just add the mode toggle to support both use cases.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles. Verify component still works in both modes.
  </verify>
  <done>
RepositorySettingsCard supports 'edit' mode showing read-only display with change option, and 'setup' mode for legacy inline editing.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update Settings Page for Onboarding-Aware Layout</name>
  <files>src/app/(dashboard)/workspace/[id]/settings/page.tsx</files>
  <action>
Update the settings page to conditionally render based on workspace onboarding status.

**Changes needed:**
1. Fetch workspace data including onboarding status (add to existing workspace query)
2. Add onboardingComplete field check (will be added to schema in future plan)
3. Conditional rendering:
   - If onboardingComplete: Show OnboardingStatusCard at top, all settings cards in 'edit' mode
   - If not onboardingComplete: Redirect to onboarding flow OR show "Complete Onboarding" CTA

**For now (since onboarding flow doesn't exist yet):**
- Add commented placeholder for onboarding redirect
- Default to showing edit mode since we're preparing for post-onboarding state
- Add OnboardingStatusCard import (conditional render when workspace has onboarding data)

**Layout order after changes:**
1. OnboardingStatusCard (if onboarded)
2. RepositorySettingsCard (edit mode)
3. ContextPathsCard (edit mode - similar changes may be needed)
4. Other existing settings cards (unchanged)

**Add to ContextPathsCard similarly:**
- Add mode prop for consistency
- Edit mode shows current paths with change option
- Keep existing functionality for backwards compatibility

**Important:** Maintain all existing settings functionality. This is additive, not destructive.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles. Page should still render without errors.
  </verify>
  <done>
Settings page conditionally renders OnboardingStatusCard and passes 'edit' mode to repository/context cards. All existing functionality preserved.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npx tsc --noEmit` passes without errors
2. Settings page still renders without crashes
3. `grep -l "OnboardingStatusCard" src/app/(dashboard)/workspace/[id]/settings/page.tsx` confirms integration
4. `grep "mode.*edit" src/components/settings/RepositorySettingsCard.tsx` confirms edit mode support
5. All existing settings functionality continues to work
</verification>

<success_criteria>
- Settings page shows OnboardingStatusCard with completion status and re-sync option
- RepositorySettingsCard in edit mode shows current repo as read-only with change option
- Settings page layout distinguishes between onboarded and non-onboarded workspaces
- All existing settings functionality is preserved (no regression)
- Re-sync button provides confirmation before triggering (button wired to future API)
</success_criteria>

<output>
After completion, create `.planning/phases/01-onboarding-foundation-a-repository-connection/01-03-SUMMARY.md`
</output>
