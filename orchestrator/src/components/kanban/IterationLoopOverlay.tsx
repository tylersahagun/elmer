\"use client\";
\n+import { useLayoutEffect, useMemo, useState } from \"react\";
import { motion } from \"framer-motion\";
import type { KanbanColumn } from \"@/lib/store\";
import { cn } from \"@/lib/utils\";
import { WaveV4D } from \"@/components/brand/ElmerLogo\";
\n+interface IterationLoopOverlayProps {\n+  containerRef: React.RefObject<HTMLDivElement>;\n+  columns: KanbanColumn[];\n+  className?: string;\n+}\n+\n+interface ColumnPoint {\n+  x: number;\n+  y: number;\n+  width: number;\n+  height: number;\n+}\n+\n+function buildPath(from: ColumnPoint, to: ColumnPoint) {\n+  const x1 = from.x + from.width / 2;\n+  const y1 = from.y + Math.min(56, from.height / 3);\n+  const x2 = to.x + to.width / 2;\n+  const y2 = to.y + Math.min(56, to.height / 3);\n+  const dx = Math.max(80, Math.abs(x2 - x1) / 2.5);\n+  return `M ${x1} ${y1} C ${x1 + dx} ${y1}, ${x2 - dx} ${y2}, ${x2} ${y2}`;\n+}\n+\n+export function IterationLoopOverlay({ containerRef, columns, className }: IterationLoopOverlayProps) {\n+  const [columnRects, setColumnRects] = useState<Record<string, ColumnPoint>>({});\n+\n+  useLayoutEffect(() => {\n+    const container = containerRef.current;\n+    if (!container) return;\n+\n+    const updateRects = () => {\n+      const containerRect = container.getBoundingClientRect();\n+      const next: Record<string, ColumnPoint> = {};\n+      columns.forEach((column) => {\n+        const element = container.querySelector(`[data-kanban-column=\"${column.id}\"]`) as HTMLElement | null;\n+        if (!element) return;\n+        const rect = element.getBoundingClientRect();\n+        next[column.id] = {\n+          x: rect.left - containerRect.left,\n+          y: rect.top - containerRect.top,\n+          width: rect.width,\n+          height: rect.height,\n+        };\n+      });\n+      setColumnRects(next);\n+    };\n+\n+    updateRects();\n+    const observer = new ResizeObserver(() => updateRects());\n+    observer.observe(container);\n+    window.addEventListener(\"resize\", updateRects);\n+    return () => {\n+      observer.disconnect();\n+      window.removeEventListener(\"resize\", updateRects);\n+    };\n+  }, [columns, containerRef]);\n+\n+  const loopEdges = useMemo(() => {\n+    const edges: Array<{ from: string; to: string; groupId?: string }>= [];\n+    columns.forEach((column) => {\n+      if (!column.loopTargets || column.loopTargets.length === 0) return;\n+      column.loopTargets.forEach((target) => {\n+        if (target === column.id) return;\n+        edges.push({ from: column.id, to: target, groupId: column.loopGroupId });\n+      });\n+    });\n+    return edges;\n+  }, [columns]);\n+\n+  if (loopEdges.length === 0) {\n+    return null;\n+  }\n+\n+  return (\n+    <div className={cn(\"pointer-events-none absolute inset-0\", className)}>\n+      <svg className=\"w-full h-full\" role=\"presentation\">\n+        <defs>\n+          <linearGradient id=\"loop-wave\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\n+            <stop offset=\"0%\" stopColor=\"#7dd3fc\" />\n+            <stop offset=\"50%\" stopColor=\"#a78bfa\" />\n+            <stop offset=\"100%\" stopColor=\"#f0abfc\" />\n+          </linearGradient>\n+        </defs>\n+        {loopEdges.map((edge, index) => {\n+          const from = columnRects[edge.from];\n+          const to = columnRects[edge.to];\n+          if (!from || !to) return null;\n+          const path = buildPath(from, to);\n+          return (\n+            <g key={`${edge.from}-${edge.to}-${index}`}>\n+              <motion.path\n+                d={path}\n+                fill=\"none\"\n+                stroke=\"url(#loop-wave)\"\n+                strokeWidth={2}\n+                strokeDasharray=\"6 8\"\n+                initial={{ strokeDashoffset: 0, opacity: 0.5 }}\n+                animate={{ strokeDashoffset: -24, opacity: [0.3, 0.8, 0.3] }}\n+                transition={{ duration: 4, repeat: Infinity, ease: \"linear\" }}\n+              />\n+            </g>\n+          );\n+        })}\n+      </svg>\n+      {loopEdges.map((edge, index) => {\n+        const from = columnRects[edge.from];\n+        if (!from) return null;\n+        const x = from.x + from.width / 2 - 10;\n+        const y = from.y + 16;\n+        return (\n+          <motion.div\n+            key={`marker-${edge.from}-${edge.to}-${index}`}\n+            className=\"absolute\"\n+            style={{ left: x, top: y }}\n+            animate={{ y: [y, y - 6, y] }}\n+            transition={{ duration: 3.5, repeat: Infinity }}\n+          >\n+            <WaveV4D className=\"w-5 h-5 text-purple-300/80\" />\n+          </motion.div>\n+        );\n+      })}\n+    </div>\n+  );\n+}\n*** End Patch"}]}...
