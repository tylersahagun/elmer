# Phase 12.5: Manual Association - Context

**Gathered:** 2026-01-22
**Status:** Ready for planning

<domain>
## Phase Boundary

Enable users to manually create and manage relationships between signals and their project/persona contexts. This is the foundation for evidence-based product decisions — the "provenance chain" that links every project back to customer feedback.

Users will:
- Link signals to projects (many-to-many: one signal can inform multiple projects)
- Link signals to personas (build evidence libraries: "Enterprise Admin personas say X")
- Unlink when associations no longer make sense
- View all signals linked to projects/personas

**This phase delivers table-stakes manual linking before AI-powered suggestions (Phase 17).**

</domain>

<decisions>
## Implementation Decisions

### Linking Interface

**Where to link from:**
- Both locations: signal modal AND project pages (bidirectional workflow)
- Signal-side: Add project/persona comboboxes in SignalDetailModal
- Project-side: Add "Link Signal" button that opens signal picker modal

**UI patterns by location:**
- **Signal modal:** Inline combobox with search → tags-style display
  - Single-add for projects (add one at a time, see all as removable tags)
  - Single-add for personas (same pattern)
  - Tags give visual feedback, easy to remove with × button
  - Consistent with existing Select components in modal
- **Project page:** Button opens signal picker modal
  - Multi-select with checkboxes (bulk linking)
  - Searchable signal list with full-text search
  - Filter by status/source
  - Exclude already-linked signals
  - "Link Selected" bulk action

**Multiple selection strategy:**
- Asymmetric based on typical cardinality:
  - Projects per signal: 1-3 → single-add combobox (tags pattern)
  - Signals per project: 5-50+ → multi-select picker (checkboxes)
  - Personas per signal: 1-3 → single-add combobox (tags pattern)

### Association Visibility

**Signal table rows (SignalRow):**
- Show first project badge + count if more (e.g., "[auth] +2")
- Show first persona badge + count if more (e.g., "[Enterprise Admin] +1")
- Minimal indicator — enough to triage at a glance
- Click badge to open project in new tab
- Provenance chain visible during scanning/filtering

**Signal detail modal (SignalDetailModal):**
- Full list of linked projects as removable tags with × buttons
- Full list of linked personas as removable tags with × buttons
- "Link to project..." combobox below existing projects
- "Link to persona..." combobox below existing personas
- All signal associations managed in one place

**Project page (ProjectDetailPage):**
- Collapsible section between project header and tabs
- "Signals (5)" trigger — collapsed by default, one-click to expand
- Visible when relevant, minimal when empty
- Doesn't compete with existing 7 tabs

**Signal list on project page:**
- Truncated verbatim (line-clamp-2, ~100 chars)
- Source badge + severity badge (if present)
- "View →" button to open signal detail modal
- Sort by linkedAt DESC (recently discovered evidence first)
- × button in corner (visible on hover) to unlink

### Unlinking Workflow

**Unlinking mechanism:**
- × button on project/persona tags (signal modal)
- × button on signal list items (project page, hover to reveal)
- Low friction for low-risk reversible action
- No confirmation dialog (signals still exist, easily re-linkable)

**Optional polish:**
- Undo toast: "Signal unlinked from project [Undo]"
- 5-second undo window before mutation is final

**Bulk unlinking:**
- No bulk unlink for MVP
- Rare action (project pivot or mistake scenarios)
- Low cost to click × multiple times
- Wait for evidence of need before adding selection state UI

**Status change on unlink:**
- When last project is unlinked, auto-update status from `linked` to `reviewed`
- Maintains state invariant: status = `linked` ↔ linkedProjects.length > 0
- Never revert to `new` (signal was already processed)
- Clean, predictable state machine

**Permissions:**
- Any workspace member can unlink
- Symmetric with linking permissions (if you can link, you can unlink)

### Persona Associations

**Data model:**
- Use existing `signalPersonas` junction table from Phase 11
- Direct associations (signalId, personaId as string)
- Independent of projects — can categorize signals before linking to work
- Distinction from `userSegment` field:
  - `userSegment`: AI-extracted user type ("enterprise", "SMB")
  - `personaId`: PM decision on product persona mapping ("Enterprise Admin", "Security Officer")

**UI placement:**
- Signal modal only (not bidirectional like projects)
- Personas are categorization tags, not active work items
- Add persona combobox below project tags in SignalDetailModal

**Persona browsing:**
- Add "Persona" filter dropdown to signals table
- "Show me all signals for Enterprise Admin"
- No dedicated personas management page needed
- Persona definitions live in static JSON files, not database

**Multiple personas:**
- Yes — support multi-persona tagging
- A signal can resonate with several personas (e.g., Enterprise Admin + Security Officer)
- Same tags-style UI as projects

**Table visibility:**
- Yes — show persona badges in SignalRow (consistent with project badges)
- First badge + count if multiple
- At-a-glance categorization during scanning

### Claude's Discretion

- Exact combobox component implementation (use shadcn/ui patterns)
- Signal picker modal layout and spacing
- Badge colors for personas (distinct from projects/sources)
- Loading states and skeleton designs
- Error handling patterns
- Collapsible section animation timing

</decisions>

<specifics>
## Specific Ideas

**Consistency with existing patterns:**
- SignalDetailModal already uses Select for status changes — use same interaction pattern for project/persona comboboxes
- InboxPanel already does inline project assignment (not via modal) — follow this precedent
- ProjectCard already has action buttons that open dialogs/panels — follow this pattern for "Link Signal" button

**Beautiful Minimalism principle:**
> "Show only what matters for current context; drill down for more"
- Table rows: Minimal indicators (badges + counts) — enough to triage
- Detail modal: Full context — enough to manage
- Collapsible section: Visible when relevant, minimal when empty

**Provenance chain visibility:**
From product vision: "Linking every product decision back to customer evidence"
- Don't hide project links until modal — users need to scan and see what's tracked vs. floating unlinked
- At-a-glance visibility is key differentiator

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope. Future enhancements:
- Drag-and-drop linking (Phase 17 or later as power-user feature)
- Bulk unlinking (wait for evidence of need)
- User-controlled sort on project signal lists (add dropdown: Recently linked / Newest signals / By severity)

</deferred>

---

*Phase: 12.5-manual-association*
*Context gathered: 2026-01-22*
