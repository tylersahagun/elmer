---
phase: 12.5-manual-association
plan: 02
subsystem: signals-ui
tags: [signals, association, combobox, modal, ui]
completed: 2026-01-22
duration: ~10 minutes

dependencies:
  requires:
    - 12.5-01 (Association APIs)
    - 12-03 (SignalDetailModal base)
  provides:
    - inline-signal-association-ui
    - removable-link-tags
    - project-persona-comboboxes
  affects:
    - 12.5-03 (Badge Visibility - already complete)
    - 13 (AI Intelligence Layer - signal linking)

tech-stack:
  added: []
  patterns:
    - tanstack-query-for-linked-data
    - optimistic-ui-with-refetch
    - select-component-for-linking

key-files:
  created:
    - orchestrator/src/components/signals/LinkedTag.tsx
    - orchestrator/src/components/signals/ProjectLinkCombobox.tsx
    - orchestrator/src/components/signals/PersonaLinkCombobox.tsx
  modified:
    - orchestrator/src/components/signals/SignalDetailModal.tsx

decisions:
  - id: combobox-over-dialog
    choice: "Use Select dropdown for linking instead of separate dialog"
    rationale: "Inline UX is faster and matches the quick-action pattern"
  - id: separate-queries
    choice: "Query linked projects and personas separately from signal data"
    rationale: "Keeps signal list query simple, allows targeted refetch on link changes"
---

# Phase 12.5 Plan 02: Signal Association Modal UI Summary

Inline project/persona association management in SignalDetailModal using comboboxes and removable tags.

## One-Liner

Signal detail modal now shows linked projects (blue) and personas (violet) as removable tags with dropdown comboboxes to add new associations.

## What Was Built

### LinkedTag Component
Reusable removable tag component with:
- Two color variants: project (blue) and persona (violet)
- X button with loading spinner during mutation
- Accessible aria-label for remove action
- Truncated label with max-width

### ProjectLinkCombobox Component
Project selection dropdown with:
- Fetches workspace projects via `/api/workspaces/{id}`
- Filters out already-linked projects
- Loading state while fetching
- "All projects linked" message when exhausted

### PersonaLinkCombobox Component
Persona selection dropdown with:
- Fetches personas via `/api/personas`
- Uses archetype_id as value (stable identifier)
- Filters out already-linked personas
- Loading state while fetching

### SignalDetailModal Updates
Extended with association management:
- Query to fetch linked projects and personas on modal open
- Four mutations: linkProject, unlinkProject, linkPersona, unlinkPersona
- Persona name resolution via cached `/api/personas` query
- UI sections showing tags with inline comboboxes

## Commits

| Hash | Type | Description |
|------|------|-------------|
| 483bade | feat | create LinkedTag reusable component |
| 08d0ed7 | feat | create ProjectLinkCombobox and PersonaLinkCombobox |
| 9705376 | feat | extend SignalDetailModal with association management |

## Verification Results

- [x] `npm run build` passes
- [x] LinkedTag component created with project/persona variants
- [x] ProjectLinkCombobox fetches and filters workspace projects
- [x] PersonaLinkCombobox fetches and filters personas
- [x] SignalDetailModal displays linked data as removable tags
- [x] Comboboxes enable adding new associations inline
- [x] Mutations trigger refetch and invalidate signals cache

## Deviations from Plan

None - plan executed exactly as written.

## Technical Details

### Data Flow
1. Modal opens -> Query fetches `/api/signals/{id}/projects` and `/api/signals/{id}/personas`
2. User clicks combobox -> Selects project/persona -> POST mutation fires
3. On success -> refetchLinks() updates local data, invalidates ["signals"] cache
4. User clicks X on tag -> DELETE mutation fires -> same refresh pattern

### Status Auto-Update
The API (from 12.5-01) handles status changes:
- First project link: signal status changes to "linked"
- Last project unlink: signal status reverts to "reviewed"
- Persona links do not affect status

## Next Phase Readiness

Phase 12.5-03 (Badge Visibility) was completed in parallel and is already done.
Phase 12.5 is now complete - all three plans executed.
