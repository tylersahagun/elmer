# Plan 05-03: Accept Invitation Flow

## Frontmatter

```yaml
plan_id: "05-03"
phase: 5
wave: 2
depends_on: ["05-01", "05-02"]
files_modified:
  - orchestrator/src/app/invite/[token]/page.tsx
  - orchestrator/src/app/api/invitations/[token]/route.ts
autonomous: true
estimated_duration: "20 minutes"
```

## Objective

Create the invitation acceptance page where users can view invitation details and accept to join the workspace.

## Context

**Existing infrastructure:**
- Invitation service with acceptInvitation function
- Token validation and expiry checking
- Auth system for user identification

**This plan adds:**
- Accept invitation page at /invite/[token]
- API endpoint for accepting invitations
- Handle expired/used links gracefully
- Auto-redirect to workspace after acceptance

## Tasks

<task id="1" name="Create Accept Invitation API">
<description>
Create API endpoint for accepting invitations.
</description>
<files>
- orchestrator/src/app/api/invitations/[token]/route.ts
</files>
<instructions>
1. Create GET endpoint to fetch invitation details (public)
2. Create POST endpoint to accept invitation (requires auth)
3. Return workspace info on success
4. Handle errors: expired, already used, not found
</instructions>
<verification>
- [ ] GET returns invitation details
- [ ] POST requires authentication
- [ ] POST adds user to workspace
- [ ] Handles all error cases
</verification>
</task>

<task id="2" name="Create Accept Invitation Page">
<description>
Create the page where users land when clicking an invite link.
</description>
<files>
- orchestrator/src/app/invite/[token]/page.tsx
</files>
<instructions>
1. Create page at /invite/[token]
2. Show invitation details (workspace name, role, inviter)
3. If not logged in, show sign in/sign up buttons
4. If logged in, show accept button
5. Handle expired/invalid tokens with clear messages
6. Redirect to workspace after acceptance
</instructions>
<verification>
- [ ] Shows invitation details
- [ ] Prompts login if not authenticated
- [ ] Accept button works for authenticated users
- [ ] Redirects to workspace after acceptance
- [ ] Shows clear error for expired/invalid links
</verification>
</task>

## Verification Criteria

After all tasks complete, verify:

1. **Valid invitation:**
   - Shows workspace name, role, inviter
   - Accept button adds user to workspace
   - Redirects to workspace

2. **Expired invitation:**
   - Shows clear "expired" message
   - Suggests contacting admin

3. **Already used invitation:**
   - Shows clear "already used" message

4. **Unauthenticated user:**
   - Shows sign in/sign up options
   - Returns to invitation after auth

## must_haves

- [ ] Invitation details display
- [ ] Auth-aware accept flow
- [ ] Clear error messages
- [ ] Redirect after acceptance

---
*Plan 05-03 | Phase 5 | Wave 2*
