# Plan 03-03: Logout Functionality and Session Management

## Frontmatter

```yaml
plan_id: "03-03"
phase: 3
wave: 1
depends_on: ["03-01"]
files_modified:
  - orchestrator/src/components/user-menu.tsx
  - orchestrator/src/app/page.tsx
autonomous: true
estimated_duration: "15 minutes"
```

## Objective

Add logout functionality and display user session state on the home page. Users should be able to see their logged-in status and sign out.

## Context

**Existing infrastructure:**
- Auth.js configured with JWT session strategy
- `signOut` exported from auth.ts
- Login and signup pages working

**This plan adds:**
- User menu component with logout button
- Session display on home page
- Protected route pattern example

## Tasks

<task id="1" name="Create User Menu Component">
<description>
Create a user menu component that shows the current user and provides logout functionality.
</description>
<files>
- orchestrator/src/components/user-menu.tsx
</files>
<instructions>
1. Create `orchestrator/src/components/user-menu.tsx` as a client component
2. Use `useSession` from next-auth/react to get current user
3. Show user avatar/name when logged in
4. Include "Sign out" button that calls `signOut()`
5. Show "Sign in" link when not logged in
6. Use DropdownMenu from shadcn/ui for the menu
</instructions>
<verification>
- [ ] Component renders without errors
- [ ] Shows user info when logged in
- [ ] Shows sign in link when logged out
- [ ] Logout button clears session
</verification>
</task>

<task id="2" name="Update Home Page with Session State">
<description>
Update the home page to show authentication state and include the user menu.
</description>
<files>
- orchestrator/src/app/page.tsx
</files>
<instructions>
1. Update `orchestrator/src/app/page.tsx`
2. Import and use `auth()` from "@/auth" for server-side session
3. Display different content based on authentication state:
   - Logged in: Show welcome message with user name, user menu
   - Logged out: Show sign in/sign up buttons
4. Keep existing page content but add auth-aware header
</instructions>
<verification>
- [ ] Home page shows user info when logged in
- [ ] Home page shows auth buttons when logged out
- [ ] User menu appears in header area
</verification>
</task>

## Verification Criteria

After all tasks complete, verify:

1. **Session persistence:**
   - Log in, refresh page → still logged in
   - Close browser, reopen → still logged in (within 30 days)

2. **Logout works:**
   - Click sign out → session cleared
   - Refresh page → shows logged out state

3. **Navigation flow:**
   - Logged out → click sign in → login page
   - Logged in → click sign out → logged out state

## must_haves

- [ ] User can see their logged-in status on home page
- [ ] User can click "Sign out" and session is cleared
- [ ] Session persists across page refresh

---
*Plan 03-03 | Phase 3 | Wave 1*
