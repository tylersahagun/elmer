---
phase: 14.6
plan: 01
subsystem: database
tags: [integrations, schema, drizzle, pylon, slack]
requires:
  - Phase 13 (webhookKeys pattern)
provides:
  - integrations table schema
  - Integration/NewIntegration types
  - IntegrationPlatform and IntegrationConfig types
affects:
  - 14.6-02 (Pylon webhook endpoint)
  - 14.6-03 (Slack webhook endpoint)
  - Future OAuth UI phase
tech-stack:
  added: []
  patterns:
    - Platform-specific credentials table
    - JSONB config for extensible settings
    - OAuth token storage pattern
key-files:
  created:
    - orchestrator/drizzle/0008_colossal_havok.sql
  modified:
    - orchestrator/src/lib/db/schema.ts
    - orchestrator/src/lib/db/index.ts
decisions:
  - id: 14.6-01-01
    decision: "Use union type for IntegrationPlatform (pylon | slack)"
    rationale: "Follows established pattern from SignalSource"
  - id: 14.6-01-02
    decision: "Store OAuth tokens directly in integrations table"
    rationale: "Simplest approach for MVP; can upgrade to secrets manager later"
  - id: 14.6-01-03
    decision: "Platform-specific fields nullable (e.g., slackTeamId, pylonAccountId)"
    rationale: "Each platform needs different fields; nullables avoid complex polymorphism"
  - id: 14.6-01-04
    decision: "IntegrationConfig as JSONB for channel/event filtering"
    rationale: "Flexible configuration without schema changes for new filter types"
metrics:
  duration: 5 minutes
  completed: 2026-01-23
---

# Phase 14.6 Plan 01: Integrations Table Schema Summary

**One-liner:** Database schema for Pylon/Slack integration credentials with platform-specific fields and JSONB config.

## What Was Built

1. **integrations table** with 17 columns:
   - Core: id, workspaceId, platform, name
   - Credentials: webhookSecret, accessToken, refreshToken, tokenExpiresAt
   - Slack-specific: slackTeamId, slackTeamName, slackBotUserId
   - Pylon-specific: pylonAccountId
   - Config: isActive, config (JSONB)
   - Metadata: lastUsedAt, createdAt, createdBy

2. **TypeScript types:**
   - `IntegrationPlatform = "pylon" | "slack"` - union type for platform enum
   - `IntegrationConfig` - interface for channel/event filtering configuration
   - `Integration` - select type for reading integrations
   - `NewIntegration` - insert type for creating integrations

3. **Relations:**
   - `integrationsRelations` - workspace and creator associations
   - Updated `workspacesRelations` to include integrations

4. **Migration:**
   - `0008_colossal_havok.sql` - creates integrations table with foreign keys

## Technical Decisions

| Decision | Rationale |
|----------|-----------|
| Union type for platform | Follows SignalSource pattern, extensible without migrations |
| Nullable platform-specific fields | Avoids complex polymorphism, each platform uses its subset |
| JSONB for config | Flexible filtering without schema changes |
| Tokens in main table | MVP simplicity; can add encryption/secrets manager later |
| SET NULL for createdBy | Preserves integration records when user is deleted |
| CASCADE for workspaceId | Cleans up integrations when workspace is deleted |

## Commits

| Commit | Description |
|--------|-------------|
| 3bb6ef8 | feat(14.6-01): add integrations table schema for third-party platforms |
| cc5e81e | chore(14.6-01): export integration types and generate migration |

## Key Files

**Created:**
- `/orchestrator/drizzle/0008_colossal_havok.sql` - Migration for integrations table

**Modified:**
- `/orchestrator/src/lib/db/schema.ts` - Added integrations table, types, and relations
- `/orchestrator/src/lib/db/index.ts` - Exported Integration types

## Verification Results

| Criterion | Status |
|-----------|--------|
| TypeScript compiles | PASSED |
| integrations table defined in schema.ts | PASSED |
| IntegrationPlatform and IntegrationConfig types defined | PASSED |
| Relations defined for workspace and creator | PASSED |
| workspacesRelations includes integrations | PASSED |
| Migration file exists in drizzle/ | PASSED |
| Types exported from lib/db/index.ts | PASSED |

## Deviations from Plan

None - plan executed exactly as written.

## Next Phase Readiness

**Ready for:**
- Plan 14.6-02: Pylon webhook endpoint (has integrations table to query)
- Plan 14.6-03: Slack webhook endpoint (has integrations table to query)

**Migration note:** Run `npx drizzle-kit migrate` before testing endpoints.
