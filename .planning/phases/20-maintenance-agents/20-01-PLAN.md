---
phase: 20-maintenance-agents
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - orchestrator/src/lib/db/schema.ts
autonomous: true

must_haves:
  truths:
    - "Workspace settings include maintenance configuration"
    - "Default maintenance settings are conservative (off by default for auto-archive)"
    - "Orphan threshold, duplicate detection, and archival settings are configurable"
  artifacts:
    - path: "orchestrator/src/lib/db/schema.ts"
      provides: "MaintenanceSettings interface and DEFAULT_MAINTENANCE_SETTINGS"
      contains: "MaintenanceSettings"
  key_links:
    - from: "orchestrator/src/lib/db/schema.ts"
      to: "WorkspaceSettings"
      via: "maintenance optional field"
      pattern: "maintenance\\?: MaintenanceSettings"
---

<objective>
Add MaintenanceSettings interface and defaults to schema for configurable signal hygiene

Purpose: Establish the configuration foundation for maintenance agents. Follows Phase 19's SignalAutomationSettings pattern - JSONB field in WorkspaceSettings with sensible defaults.

Output: MaintenanceSettings interface with orphan threshold, duplicate detection, archival, and notification settings
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-maintenance-agents/20-RESEARCH.md

# Prior pattern to follow
@orchestrator/src/lib/db/schema.ts (SignalAutomationSettings section)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add MaintenanceSettings interface to schema</name>
  <files>orchestrator/src/lib/db/schema.ts</files>
  <action>
Add MaintenanceSettings interface after the SignalAutomationSettings section (around line 140).

Define MaintenanceSettings interface with these fields:
```typescript
export interface MaintenanceSettings {
  // Orphan detection
  orphanThresholdDays: number;           // Days before unlinked signal is flagged (default: 14)
  flagOrphansEnabled: boolean;           // Whether to detect orphans (default: true)

  // Duplicate detection
  duplicateDetectionEnabled: boolean;    // Whether to detect duplicates (default: true)
  duplicateSimilarityThreshold: number;  // Cosine similarity threshold 0-1 (default: 0.9)

  // Auto-archival
  autoArchiveEnabled: boolean;           // Whether to auto-archive (default: false - conservative)
  autoArchiveLinkedAfterDays: number;    // Archive linked signals after N days (default: 90)
  autoArchiveReviewedAfterDays: number;  // Archive reviewed signals after N days (default: 30)

  // Cleanup suggestions
  suggestAssociationsEnabled: boolean;   // Whether to suggest links (default: true)
  minSuggestionConfidence: number;       // Min confidence for suggestions (default: 0.6)

  // Notifications
  notifyOnOrphanThreshold: number | null; // Notify when orphan count >= N (default: 10)
  notifyOnDuplicates: boolean;           // Notify when duplicates found (default: false)
}
```

Add DEFAULT_MAINTENANCE_SETTINGS constant:
```typescript
export const DEFAULT_MAINTENANCE_SETTINGS: MaintenanceSettings = {
  orphanThresholdDays: 14,
  flagOrphansEnabled: true,
  duplicateDetectionEnabled: true,
  duplicateSimilarityThreshold: 0.9,
  autoArchiveEnabled: false,
  autoArchiveLinkedAfterDays: 90,
  autoArchiveReviewedAfterDays: 30,
  suggestAssociationsEnabled: true,
  minSuggestionConfidence: 0.6,
  notifyOnOrphanThreshold: 10,
  notifyOnDuplicates: false,
};
```

Pattern follows SignalAutomationSettings - conservative defaults, opt-in for aggressive features.
  </action>
  <verify>
Run: `cd /Users/tylersahagun/Source/elmer/orchestrator && npx tsc --noEmit`
Grep: `grep -n "MaintenanceSettings" src/lib/db/schema.ts`
  </verify>
  <done>MaintenanceSettings interface exists with all fields and DEFAULT_MAINTENANCE_SETTINGS constant defined</done>
</task>

<task type="auto">
  <name>Task 2: Extend WorkspaceSettings with maintenance field</name>
  <files>orchestrator/src/lib/db/schema.ts</files>
  <action>
Add optional `maintenance` field to WorkspaceSettings interface (after the signalAutomation field):

```typescript
export interface WorkspaceSettings {
  // ... existing fields ...

  // Signal Automation Settings (Phase 19)
  signalAutomation?: SignalAutomationSettings;

  // Maintenance Settings (Phase 20)
  maintenance?: MaintenanceSettings;
}
```

This follows the exact same pattern as signalAutomation - optional JSONB field for per-workspace configuration.
  </action>
  <verify>
Run: `cd /Users/tylersahagun/Source/elmer/orchestrator && npx tsc --noEmit`
Grep: `grep -A2 "signalAutomation" src/lib/db/schema.ts | grep maintenance`
  </verify>
  <done>WorkspaceSettings includes optional maintenance field of type MaintenanceSettings</done>
</task>

</tasks>

<verification>
- [ ] TypeScript compiles without errors
- [ ] MaintenanceSettings interface defined with all 11 configuration fields
- [ ] DEFAULT_MAINTENANCE_SETTINGS constant with conservative defaults
- [ ] WorkspaceSettings extended with optional maintenance field
- [ ] Pattern matches SignalAutomationSettings approach
</verification>

<success_criteria>
1. MaintenanceSettings interface is exported from schema.ts
2. DEFAULT_MAINTENANCE_SETTINGS constant is exported from schema.ts
3. WorkspaceSettings.maintenance is optional and typed as MaintenanceSettings
4. TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/20-maintenance-agents/20-01-SUMMARY.md`
</output>
