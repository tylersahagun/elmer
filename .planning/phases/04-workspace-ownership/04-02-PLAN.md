# Plan 04-02: Workspace Switcher and First-Time User Flow

## Frontmatter

```yaml
plan_id: "04-02"
phase: 4
wave: 1
depends_on: ["04-01"]
files_modified:
  - orchestrator/src/components/workspace-switcher.tsx
  - orchestrator/src/app/page.tsx
autonomous: true
estimated_duration: "25 minutes"
```

## Objective

Create a workspace switcher component and update the home page to handle first-time users who have no workspaces yet.

## Context

**Existing infrastructure:**
- GET /api/workspaces returns user's workspaces with role
- Home page shows workspace list
- Users can create workspaces

**This plan adds:**
- Workspace switcher dropdown component
- First-time user onboarding prompt
- Better empty state handling

## Tasks

<task id="1" name="Create Workspace Switcher Component">
<description>
Create a dropdown component that shows user's workspaces and allows switching between them.
</description>
<files>
- orchestrator/src/components/workspace-switcher.tsx
</files>
<instructions>
1. Create `orchestrator/src/components/workspace-switcher.tsx`
2. Use DropdownMenu from shadcn/ui
3. Show current workspace name with role badge
4. List all user's workspaces
5. Include "Create new workspace" option
6. Use useQuery to fetch workspaces
7. Handle loading and error states
</instructions>
<verification>
- [ ] Component renders without errors
- [ ] Shows current workspace
- [ ] Lists all workspaces with roles
- [ ] Create option opens dialog
</verification>
</task>

<task id="2" name="Update Home Page for Auth States">
<description>
Update the home page to handle different authentication and workspace states.
</description>
<files>
- orchestrator/src/app/page.tsx
</files>
<instructions>
1. Check session state using useSession
2. If not authenticated: Show sign in/sign up buttons
3. If authenticated but no workspaces: Show onboarding prompt
4. If authenticated with workspaces: Show workspace list (existing behavior)
5. Add workspace switcher to navbar area
</instructions>
<verification>
- [ ] Unauthenticated users see auth buttons
- [ ] First-time users see onboarding prompt
- [ ] Returning users see their workspaces
</verification>
</task>

## Verification Criteria

After all tasks complete, verify:

1. **Workspace switcher works:**
   - Shows current workspace
   - Can switch between workspaces
   - Create new workspace option works

2. **First-time user flow:**
   - New user logs in
   - Sees prompt to create first workspace
   - After creation, sees workspace in list

3. **Auth states handled:**
   - Logged out: See sign in buttons
   - Logged in, no workspaces: See onboarding
   - Logged in, has workspaces: See workspace list

## must_haves

- [ ] Workspace switcher shows all user's workspaces
- [ ] First-time users prompted to create workspace
- [ ] Unauthenticated users directed to sign in

---
*Plan 04-02 | Phase 4 | Wave 1*
