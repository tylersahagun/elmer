# Plan 04-03: Workspace Settings and Member Management

## Frontmatter

```yaml
plan_id: "04-03"
phase: 4
wave: 1
depends_on: ["04-01", "04-02"]
files_modified:
  - orchestrator/src/app/workspace/[id]/settings/page.tsx
  - orchestrator/src/app/api/workspaces/[id]/members/route.ts
  - orchestrator/src/lib/db/queries.ts
autonomous: true
estimated_duration: "25 minutes"
```

## Objective

Create workspace settings page where admins can rename workspaces and view member list with roles.

## Context

**Existing infrastructure:**
- Workspace members table with roles
- Users can be admin, member, or viewer
- Workspace detail pages exist

**This plan adds:**
- Workspace settings page
- Member list display
- Workspace rename functionality (admin only)

## Tasks

<task id="1" name="Add Workspace Member Queries">
<description>
Add query functions to get workspace members with user details.
</description>
<files>
- orchestrator/src/lib/db/queries.ts
</files>
<instructions>
1. Add `getWorkspaceMembers(workspaceId)` function
2. Join workspaceMembers with users table
3. Return user info (id, name, email, image) with role
4. Order by role (admin first) then joinedAt
</instructions>
<verification>
- [ ] Function returns members with user details
- [ ] Includes role information
- [ ] Properly ordered
</verification>
</task>

<task id="2" name="Create Members API Route">
<description>
Create API route to get workspace members.
</description>
<files>
- orchestrator/src/app/api/workspaces/[id]/members/route.ts
</files>
<instructions>
1. Create GET endpoint to fetch workspace members
2. Require authentication
3. Only allow members of workspace to view
4. Return member list with user details
</instructions>
<verification>
- [ ] GET returns member list
- [ ] Auth required
- [ ] Only workspace members can access
</verification>
</task>

<task id="3" name="Create Workspace Settings Page">
<description>
Create settings page for workspace with member list and rename form.
</description>
<files>
- orchestrator/src/app/workspace/[id]/settings/page.tsx
</files>
<instructions>
1. Create settings page component
2. Show workspace name with edit form (admin only)
3. Display member list with roles and avatars
4. Use existing UI components (Card, Avatar, Badge)
5. Add back navigation to workspace
</instructions>
<verification>
- [ ] Settings page renders
- [ ] Member list displays correctly
- [ ] Admin can rename workspace
- [ ] Non-admins see read-only view
</verification>
</task>

## Verification Criteria

After all tasks complete, verify:

1. **Member list works:**
   - Navigate to workspace settings
   - See list of members with roles
   - Avatars and names display correctly

2. **Rename works (admin):**
   - As admin, can edit workspace name
   - Changes persist after save

3. **Permissions enforced:**
   - Non-admin cannot rename
   - Non-members cannot access settings

## must_haves

- [ ] Workspace members visible in settings
- [ ] Admin can rename workspace
- [ ] Roles displayed correctly

---
*Plan 04-03 | Phase 4 | Wave 1*
