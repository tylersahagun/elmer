---
phase: 19-workflow-automation
plan: 05
type: execute
wave: 2
depends_on: ["19-01"]
files_modified:
  - orchestrator/src/components/settings/SignalAutomationSettings.tsx
  - orchestrator/src/components/kanban/WorkspaceSettingsModal.tsx
autonomous: false

must_haves:
  truths:
    - "User can configure automation depth via dropdown"
    - "User can set threshold values for auto-initiative and auto-PRD"
    - "User can configure notification thresholds"
    - "Settings persist to workspace.settings.signalAutomation"
  artifacts:
    - path: "orchestrator/src/components/settings/SignalAutomationSettings.tsx"
      provides: "SignalAutomationSettingsPanel component"
      exports: ["SignalAutomationSettingsPanel"]
    - path: "orchestrator/src/components/kanban/WorkspaceSettingsModal.tsx"
      provides: "Integration of SignalAutomationSettingsPanel as new tab"
      contains: "SignalAutomationSettingsPanel"
  key_links:
    - from: "orchestrator/src/components/settings/SignalAutomationSettings.tsx"
      to: "lib/db/schema.ts"
      via: "SignalAutomationSettings type import"
      pattern: "SignalAutomationSettings"
---

<objective>
Create UI for configuring signal automation settings.

Purpose: Allow users to configure automation depth, thresholds, and notification settings per workspace. AUTO-01 requirement - configurable automation depth per workflow stage.

Output: SignalAutomationSettingsPanel component integrated into WorkspaceSettingsModal.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19-workflow-automation/19-RESEARCH.md
@.planning/phases/19-workflow-automation/19-01-SUMMARY.md

# Existing settings modal pattern
@orchestrator/src/components/kanban/WorkspaceSettingsModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SignalAutomationSettingsPanel component</name>
  <files>orchestrator/src/components/settings/SignalAutomationSettings.tsx</files>
  <action>
Create directory and file `orchestrator/src/components/settings/SignalAutomationSettings.tsx`:

```typescript
"use client";

/**
 * Signal Automation Settings Panel
 *
 * Configuration UI for signal automation (Phase 19).
 * Renders in WorkspaceSettingsModal as a new tab.
 */

import { Switch } from "@/components/ui/switch";
import { Label } from "@/components/ui/label";
import { Input } from "@/components/ui/input";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { Slider } from "@/components/ui/slider";
import { DEFAULT_SIGNAL_AUTOMATION, type SignalAutomationSettings, type SignalSeverity } from "@/lib/db/schema";
import { Zap, Bell, Shield, Clock } from "lucide-react";

interface Props {
  settings: SignalAutomationSettings;
  onChange: (settings: SignalAutomationSettings) => void;
}

export function SignalAutomationSettingsPanel({ settings, onChange }: Props) {
  const update = <K extends keyof SignalAutomationSettings>(
    key: K,
    value: SignalAutomationSettings[K]
  ) => {
    onChange({ ...settings, [key]: value });
  };

  return (
    <div className="space-y-6">
      {/* Automation Depth */}
      <div className="space-y-3">
        <div className="flex items-center gap-2">
          <Zap className="h-4 w-4 text-amber-500" />
          <Label className="text-sm font-medium">Automation Depth</Label>
        </div>
        <Select
          value={settings.automationDepth}
          onValueChange={(v) =>
            update("automationDepth", v as SignalAutomationSettings["automationDepth"])
          }
        >
          <SelectTrigger className="bg-white/5 border-white/10">
            <SelectValue />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="manual">
              <span className="flex flex-col">
                <span>Manual</span>
                <span className="text-xs text-muted-foreground">No automatic actions</span>
              </span>
            </SelectItem>
            <SelectItem value="suggest">
              <span className="flex flex-col">
                <span>Suggest</span>
                <span className="text-xs text-muted-foreground">Show recommendations only</span>
              </span>
            </SelectItem>
            <SelectItem value="auto_create">
              <span className="flex flex-col">
                <span>Auto-Create</span>
                <span className="text-xs text-muted-foreground">Create initiatives automatically</span>
              </span>
            </SelectItem>
            <SelectItem value="full_auto">
              <span className="flex flex-col">
                <span>Full Auto</span>
                <span className="text-xs text-muted-foreground">Create initiatives + trigger PRD</span>
              </span>
            </SelectItem>
          </SelectContent>
        </Select>
        <p className="text-xs text-muted-foreground">
          Control how aggressively the system acts on signal patterns.
        </p>
      </div>

      {/* Thresholds Section */}
      <div className="space-y-4 pt-4 border-t border-white/10">
        <div className="flex items-center gap-2">
          <Shield className="h-4 w-4 text-blue-500" />
          <h4 className="text-sm font-medium">Action Thresholds</h4>
        </div>

        <div className="grid grid-cols-2 gap-4">
          <div className="space-y-2">
            <Label className="text-xs">Auto-Initiative (signals)</Label>
            <Input
              type="number"
              min={2}
              max={20}
              className="bg-white/5 border-white/10"
              value={settings.autoInitiativeThreshold}
              onChange={(e) => update("autoInitiativeThreshold", Number(e.target.value))}
            />
            <p className="text-xs text-muted-foreground">
              Min signals to create initiative
            </p>
          </div>

          <div className="space-y-2">
            <Label className="text-xs">Auto-PRD (signals)</Label>
            <Input
              type="number"
              min={3}
              max={30}
              className="bg-white/5 border-white/10"
              value={settings.autoPrdThreshold}
              onChange={(e) => update("autoPrdThreshold", Number(e.target.value))}
            />
            <p className="text-xs text-muted-foreground">
              Min signals to trigger PRD
            </p>
          </div>
        </div>

        {/* Confidence Threshold */}
        <div className="space-y-2">
          <div className="flex items-center justify-between">
            <Label className="text-xs">Min Cluster Confidence</Label>
            <span className="text-xs text-muted-foreground">
              {Math.round(settings.minClusterConfidence * 100)}%
            </span>
          </div>
          <Slider
            value={[settings.minClusterConfidence * 100]}
            onValueChange={([v]) => update("minClusterConfidence", v / 100)}
            min={50}
            max={100}
            step={5}
            className="w-full"
          />
          <p className="text-xs text-muted-foreground">
            Clusters below this similarity won't trigger automation
          </p>
        </div>

        {/* Severity Filter */}
        <div className="space-y-2">
          <Label className="text-xs">Min Severity for Auto-Actions</Label>
          <Select
            value={settings.minSeverityForAuto ?? "any"}
            onValueChange={(v) =>
              update("minSeverityForAuto", v === "any" ? null : (v as SignalSeverity))
            }
          >
            <SelectTrigger className="bg-white/5 border-white/10">
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="any">Any severity</SelectItem>
              <SelectItem value="low">Low or higher</SelectItem>
              <SelectItem value="medium">Medium or higher</SelectItem>
              <SelectItem value="high">High or higher</SelectItem>
              <SelectItem value="critical">Critical only</SelectItem>
            </SelectContent>
          </Select>
        </div>
      </div>

      {/* Notification Settings */}
      <div className="space-y-4 pt-4 border-t border-white/10">
        <div className="flex items-center gap-2">
          <Bell className="h-4 w-4 text-purple-500" />
          <h4 className="text-sm font-medium">Notification Thresholds</h4>
        </div>

        <div className="grid grid-cols-2 gap-4">
          <div className="space-y-2">
            <Label className="text-xs">Notify on Cluster Size</Label>
            <Input
              type="number"
              min={1}
              max={20}
              className="bg-white/5 border-white/10"
              value={settings.notifyOnClusterSize ?? ""}
              placeholder="Any size"
              onChange={(e) =>
                update("notifyOnClusterSize", e.target.value ? Number(e.target.value) : null)
              }
            />
          </div>

          <div className="space-y-2">
            <Label className="text-xs">Notify on Severity</Label>
            <Select
              value={settings.notifyOnSeverity ?? "any"}
              onValueChange={(v) =>
                update("notifyOnSeverity", v === "any" ? null : (v as SignalSeverity))
              }
            >
              <SelectTrigger className="bg-white/5 border-white/10">
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="any">Any severity</SelectItem>
                <SelectItem value="low">Low or higher</SelectItem>
                <SelectItem value="medium">Medium or higher</SelectItem>
                <SelectItem value="high">High or higher</SelectItem>
                <SelectItem value="critical">Critical only</SelectItem>
              </SelectContent>
            </Select>
          </div>
        </div>

        <div className="flex items-center justify-between">
          <div>
            <Label className="text-sm">Suppress Duplicate Notifications</Label>
            <p className="text-xs text-muted-foreground">
              Don't notify for same cluster within cooldown
            </p>
          </div>
          <Switch
            checked={settings.suppressDuplicateNotifications}
            onCheckedChange={(v) => update("suppressDuplicateNotifications", v)}
          />
        </div>
      </div>

      {/* Rate Limiting */}
      <div className="space-y-4 pt-4 border-t border-white/10">
        <div className="flex items-center gap-2">
          <Clock className="h-4 w-4 text-green-500" />
          <h4 className="text-sm font-medium">Rate Limiting</h4>
        </div>

        <div className="grid grid-cols-2 gap-4">
          <div className="space-y-2">
            <Label className="text-xs">Max Actions/Day</Label>
            <Input
              type="number"
              min={1}
              max={100}
              className="bg-white/5 border-white/10"
              value={settings.maxAutoActionsPerDay}
              onChange={(e) => update("maxAutoActionsPerDay", Number(e.target.value))}
            />
          </div>

          <div className="space-y-2">
            <Label className="text-xs">Cooldown (minutes)</Label>
            <Input
              type="number"
              min={5}
              max={1440}
              className="bg-white/5 border-white/10"
              value={settings.cooldownMinutes}
              onChange={(e) => update("cooldownMinutes", Number(e.target.value))}
            />
          </div>
        </div>
        <p className="text-xs text-muted-foreground">
          Safety limits to prevent runaway automation
        </p>
      </div>
    </div>
  );
}

// Re-export defaults for convenience
export { DEFAULT_SIGNAL_AUTOMATION };
```
  </action>
  <verify>TypeScript compiles: `cd orchestrator && npx tsc --noEmit`</verify>
  <done>SignalAutomationSettingsPanel component created with all configuration options</done>
</task>

<task type="auto">
  <name>Task 2: Integrate into WorkspaceSettingsModal</name>
  <files>orchestrator/src/components/kanban/WorkspaceSettingsModal.tsx</files>
  <action>
Update `orchestrator/src/components/kanban/WorkspaceSettingsModal.tsx` to add the Signal Automation tab:

1. Add import at top:
```typescript
import { SignalAutomationSettingsPanel, DEFAULT_SIGNAL_AUTOMATION } from "@/components/settings/SignalAutomationSettings";
import type { SignalAutomationSettings } from "@/lib/db/schema";
import { Bot } from "lucide-react";
```

2. Add state for signal automation settings (near other state declarations around line 85-110):
```typescript
// Signal Automation Settings (Phase 19)
const [signalAutomation, setSignalAutomation] = useState<SignalAutomationSettings>(DEFAULT_SIGNAL_AUTOMATION);
```

3. In the useEffect that loads workspace settings (around line 136-150), add loading of signalAutomation:
```typescript
// Add inside the if (workspace) block
setSignalAutomation(workspace.settings?.signalAutomation ?? DEFAULT_SIGNAL_AUTOMATION);
```

4. In the handleSave function, include signalAutomation in the settings being saved:
```typescript
// In the settings object being constructed for save, add:
signalAutomation,
```

5. Add a new tab to the TabsList (find the existing TabsList around line 300+):
```typescript
<TabsTrigger value="automation" className="flex items-center gap-2">
  <Bot className="h-4 w-4" />
  <span>Automation</span>
</TabsTrigger>
```

6. Add the TabsContent for the automation tab (after the last existing TabsContent):
```typescript
<TabsContent value="automation" className="space-y-4 mt-4">
  <SignalAutomationSettingsPanel
    settings={signalAutomation}
    onChange={setSignalAutomation}
  />
</TabsContent>
```

Note: The Bot icon is imported from lucide-react. Ensure the TabsList can accommodate an additional tab (may need to adjust spacing or use a scrollable list if tabs overflow).
  </action>
  <verify>TypeScript compiles: `cd orchestrator && npx tsc --noEmit`</verify>
  <done>WorkspaceSettingsModal includes new Automation tab with SignalAutomationSettingsPanel</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Signal automation settings UI integrated into workspace settings modal</what-built>
  <how-to-verify>
    1. Start the dev server: `cd orchestrator && npm run dev`
    2. Navigate to any workspace
    3. Open workspace settings (gear icon or Settings button)
    4. Look for new "Automation" tab with Bot icon
    5. Click the Automation tab
    6. Verify the following controls are visible:
       - Automation Depth dropdown (Manual/Suggest/Auto-Create/Full Auto)
       - Auto-Initiative threshold input
       - Auto-PRD threshold input
       - Cluster confidence slider
       - Severity filter dropdown
       - Notification threshold inputs
       - Suppress duplicates toggle
       - Rate limiting inputs
    7. Change some values and click Save
    8. Close and reopen settings - values should persist
  </how-to-verify>
  <resume-signal>Type "approved" to complete, or describe any UI issues</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compilation: `cd orchestrator && npx tsc --noEmit` passes
2. SignalAutomationSettingsPanel component renders correctly
3. WorkspaceSettingsModal shows Automation tab
4. Settings persist when saved and reloaded
</verification>

<success_criteria>
- User can access Automation tab in workspace settings
- User can configure automation depth (manual/suggest/auto_create/full_auto)
- User can set threshold values for initiatives and PRD
- User can configure notification thresholds
- Settings persist to workspace.settings.signalAutomation
</success_criteria>

<output>
After completion, create `.planning/phases/19-workflow-automation/19-05-SUMMARY.md`
</output>
