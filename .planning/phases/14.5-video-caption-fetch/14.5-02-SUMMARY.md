---
phase: 14.5-video-caption-fetch
plan: 02
subsystem: api
tags: [youtube, video, captions, signals, nextjs-api]

# Dependency graph
requires:
  - phase: 14.5-01
    provides: Video caption infrastructure (parseVideoUrl, extractYouTubeCaptions, formatters)
provides:
  - POST /api/signals/video endpoint for video caption fetch and signal creation
  - YouTube video URL processing with caption extraction
  - Loom URL detection with "coming soon" message
  - Video source signals with platform metadata
affects: [14.5-03-video-link-ui, signals-ui]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Video API route follows upload route pattern for consistency"
    - "Platform-specific handling with extensible switch for future platforms"
    - "Async activity logging with after() pattern (Phase 13)"

key-files:
  created:
    - orchestrator/src/app/api/signals/video/route.ts
  modified: []

key-decisions:
  - "Return 400 with helpful message for Loom URLs (not 501) for user-friendly error"
  - "sourceRef format: video-{platform}-{timestamp}-{nanoid(6)} for uniqueness"
  - "sourceMetadata includes videoUrl, videoPlatform, sourceName, rawPayload for complete provenance"

patterns-established:
  - "Video signal creation follows file upload signal pattern for consistency"

# Metrics
duration: 1min
completed: 2026-01-23
---

# Phase 14.5 Plan 02: Video API Endpoint Summary

**POST /api/signals/video endpoint for fetching YouTube captions and creating signals with video source attribution**

## Performance

- **Duration:** 1 min
- **Started:** 2026-01-23T16:56:57Z
- **Completed:** 2026-01-23T16:57:48Z
- **Tasks:** 1
- **Files created:** 1

## Accomplishments

- Created POST /api/signals/video endpoint accepting JSON body
- Implemented YouTube URL parsing and caption extraction via lib/video
- Returns helpful "coming soon" message for Loom URLs
- Creates signals with source="video" and full video metadata
- Integrated async activity logging using after() pattern

## Task Commits

1. **Task 1: Create /api/signals/video route** - `f483bc1` (feat)

## Files Created/Modified

- `orchestrator/src/app/api/signals/video/route.ts` - POST endpoint for video caption fetch and signal creation

## Decisions Made

1. **Loom returns 400 not 501** - Using 400 with a helpful message ("coming soon") is more user-friendly than a generic "not implemented" error
2. **sourceRef format** - video-{platform}-{timestamp}-{nanoid(6)} ensures uniqueness and enables platform identification
3. **Complete sourceMetadata** - Includes videoUrl, videoPlatform, sourceName, and rawPayload with videoId, language, segmentCount, charCount for full provenance chain

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Video API endpoint ready for UI integration in 14.5-03
- Endpoint tested with TypeScript compilation
- Follows established patterns from /api/signals/upload for consistency
- Ready for VideoLinkTab component to call POST /api/signals/video

---
*Phase: 14.5-video-caption-fetch*
*Completed: 2026-01-23*
