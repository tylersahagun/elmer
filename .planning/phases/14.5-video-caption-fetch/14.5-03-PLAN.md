---
phase: 14.5-video-caption-fetch
plan: 03
type: execute
wave: 3
depends_on: ["14.5-02"]
files_modified:
  - orchestrator/src/components/signals/VideoLinkTab.tsx
  - orchestrator/src/components/signals/CreateSignalModal.tsx
autonomous: true

must_haves:
  truths:
    - "User can see 'Video Link' tab in CreateSignalModal"
    - "User can paste YouTube URL and click 'Fetch Captions'"
    - "Loading state shown while fetching captions"
    - "Success creates signal and closes modal"
    - "Error message displayed if fetch fails"
  artifacts:
    - path: "orchestrator/src/components/signals/VideoLinkTab.tsx"
      provides: "Video URL input component with fetch mutation"
      exports: ["VideoLinkTab"]
    - path: "orchestrator/src/components/signals/CreateSignalModal.tsx"
      provides: "Tabbed modal with Paste, Upload, and Video Link tabs"
      contains: "TabsTrigger value=\"video\""
  key_links:
    - from: "orchestrator/src/components/signals/VideoLinkTab.tsx"
      to: "/api/signals/video"
      via: "fetch POST call in useMutation"
      pattern: "fetch.*api/signals/video"
    - from: "orchestrator/src/components/signals/CreateSignalModal.tsx"
      to: "orchestrator/src/components/signals/VideoLinkTab.tsx"
      via: "VideoLinkTab import and render"
      pattern: "import.*VideoLinkTab"
---

<objective>
Create VideoLinkTab component and integrate into CreateSignalModal as third tab.

Purpose: Complete the user-facing video caption fetch flow. Users can switch to "Video Link" tab, paste a YouTube URL, and create a signal from the video's captions.

Output: VideoLinkTab.tsx component and updated CreateSignalModal.tsx with three tabs (Paste Text, Upload File, Video Link).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14.5-video-caption-fetch/14.5-RESEARCH.md
@orchestrator/src/components/signals/CreateSignalModal.tsx
@orchestrator/src/components/signals/FileUploadTab.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VideoLinkTab component</name>
  <files>orchestrator/src/components/signals/VideoLinkTab.tsx</files>
  <action>
Create VideoLinkTab following FileUploadTab pattern:

1. "use client" directive at top

2. Imports:
   - useState from "react"
   - useMutation, useQueryClient from "@tanstack/react-query"
   - Loader2, Link, Video from "lucide-react"
   - Button from "@/components/ui/button"
   - Input from "@/components/ui/input"
   - Label from "@/components/ui/label"
   - Textarea from "@/components/ui/textarea"
   - DialogFooter from "@/components/ui/dialog"

3. Props interface:
   ```typescript
   interface VideoLinkTabProps {
     workspaceId: string;
     onSuccess: () => void;
     onClose: () => void;
   }
   ```

4. Component state:
   - videoUrl: string (empty string initial)
   - interpretation: string (empty string initial)
   - error: string | null (null initial)

5. useMutation for fetch:
   - mutationFn: POST to /api/signals/video with JSON body { videoUrl, workspaceId, interpretation? }
   - onSuccess: invalidate signals query, reset state, call onSuccess(), call onClose()
   - onError: setError(err.message)

6. Basic URL validation (client-side hint only - server does real validation):
   - isValidUrl = videoUrl.includes("youtube") || videoUrl.includes("youtu.be") || videoUrl.includes("loom.com")

7. UI structure:
   - div.space-y-4.py-4 wrapper
   - Label "Video URL" with Input (pl-10 for icon space)
   - Link icon positioned absolutely in input
   - Placeholder: "https://www.youtube.com/watch?v=..."
   - Helper text: "Paste a YouTube video link. We'll fetch the existing captions."
   - Error display (text-sm text-red-500) below input
   - Label "Interpretation (optional)" with Textarea (2 rows, resize-none)
   - DialogFooter with Cancel button and "Fetch Captions" button
   - Fetch button: disabled if !videoUrl.trim() || !isValidUrl || isPending
   - Show Loader2 spinner and Video icon in button when appropriate

8. handleSubmit: setError(null), then mutate()
  </action>
  <verify>
    - `cat orchestrator/src/components/signals/VideoLinkTab.tsx` shows component
    - Component has "use client" directive
    - Component exports VideoLinkTab function
  </verify>
  <done>
    - VideoLinkTab.tsx created with URL input, interpretation textarea, and submit button
    - useMutation calls /api/signals/video
    - Loading state shows spinner
    - Error state displays message
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate VideoLinkTab into CreateSignalModal</name>
  <files>orchestrator/src/components/signals/CreateSignalModal.tsx</files>
  <action>
Modify CreateSignalModal to add third tab:

1. Add import:
   ```typescript
   import { VideoLinkTab } from "./VideoLinkTab";
   ```

2. Update TabsList to 3 columns:
   ```typescript
   <TabsList className="grid w-full grid-cols-3">
     <TabsTrigger value="paste">Paste Text</TabsTrigger>
     <TabsTrigger value="upload">Upload File</TabsTrigger>
     <TabsTrigger value="video">Video Link</TabsTrigger>
   </TabsList>
   ```

3. Add TabsContent for video:
   ```typescript
   <TabsContent value="video" className="mt-4">
     <VideoLinkTab
       workspaceId={workspaceId}
       onSuccess={onSuccess}
       onClose={handleClose}
     />
   </TabsContent>
   ```

4. Update DialogDescription to mention all three options:
   "Add user feedback by pasting text, uploading a file, or fetching video captions."
  </action>
  <verify>
    - `grep "grid-cols-3" orchestrator/src/components/signals/CreateSignalModal.tsx` shows updated TabsList
    - `grep "VideoLinkTab" orchestrator/src/components/signals/CreateSignalModal.tsx` shows import and usage
    - `cd orchestrator && npx tsc --noEmit` passes
  </verify>
  <done>
    - CreateSignalModal has three tabs: Paste Text, Upload File, Video Link
    - VideoLinkTab integrated with same props as FileUploadTab
    - Dialog description updated to mention video captions
    - TypeScript compiles without errors
  </done>
</task>

</tasks>

<verification>
- [ ] VideoLinkTab.tsx exists and exports VideoLinkTab component
- [ ] CreateSignalModal.tsx imports and renders VideoLinkTab
- [ ] TabsList shows 3 columns (grid-cols-3)
- [ ] `npx tsc --noEmit` passes in orchestrator/
</verification>

<success_criteria>
- CreateSignalModal shows three tabs: "Paste Text", "Upload File", "Video Link"
- Video Link tab has URL input with Link icon
- Fetch Captions button triggers API call to /api/signals/video
- Loading spinner shows during fetch
- Error messages display below URL input
- Success invalidates signals query and closes modal
</success_criteria>

<output>
After completion, create `.planning/phases/14.5-video-caption-fetch/14.5-03-SUMMARY.md`
</output>
