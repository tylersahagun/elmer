---
phase: 14.5-video-caption-fetch
plan: 01
subsystem: api
tags: [youtube, video, captions, transcripts, youtube-caption-extractor]

# Dependency graph
requires:
  - phase: 14-file-&-paste-upload
    provides: lib/files/ pattern for extraction modules
provides:
  - lib/video/ module with URL validators, timestamp formatters, YouTube caption extraction
  - parseVideoUrl function for YouTube/Loom URL parsing
  - extractYouTubeCaptions function for transcript retrieval
  - CaptionExtractionResult interface matching lib/files/ExtractionResult pattern
affects: [14.5-02-video-api-endpoint, 14.5-03-video-link-ui]

# Tech tracking
tech-stack:
  added: [youtube-caption-extractor@1.9.1]
  patterns: [video-extraction-module, platform-url-parsing, timestamp-formatting]

key-files:
  created:
    - orchestrator/src/lib/video/validators.ts
    - orchestrator/src/lib/video/formatters.ts
    - orchestrator/src/lib/video/extractCaptions.ts
    - orchestrator/src/lib/video/index.ts
  modified:
    - orchestrator/package.json
    - orchestrator/package-lock.json

key-decisions:
  - "youtube-caption-extractor chosen for serverless compatibility and no API key requirement"
  - "Loom URLs detected but not implemented (platform='loom') for future extension"
  - "Timestamp format: M:SS for <1hr, H:MM:SS for >=1hr"
  - "CaptionExtractionResult interface mirrors lib/files/ExtractionResult pattern"

patterns-established:
  - "Video URL parsing: parseVideoUrl returns platform, videoId, isValid, error"
  - "Caption segments: CaptionSegment has start, duration, text"
  - "Timestamp formatting: formatTimestamp converts seconds to human-readable"

# Metrics
duration: 1min
completed: 2026-01-23
---

# Phase 14.5 Plan 01: Video Caption Infrastructure Summary

**YouTube caption extraction module with URL validators, timestamp formatters, and youtube-caption-extractor integration**

## Performance

- **Duration:** 1 min 25 sec
- **Started:** 2026-01-23T16:53:38Z
- **Completed:** 2026-01-23T16:55:03Z
- **Tasks:** 1
- **Files modified:** 6

## Accomplishments

- Created lib/video/ module following lib/files/ pattern from Phase 14
- Implemented parseVideoUrl supporting YouTube (5 URL formats) and Loom detection
- Implemented formatTimestamp for human-readable timestamps (M:SS and H:MM:SS)
- Implemented extractYouTubeCaptions using youtube-caption-extractor library
- Exported all types and functions via barrel index.ts

## Task Commits

Each task was committed atomically:

1. **Task 1: Install youtube-caption-extractor and create video infrastructure** - `c5bf3e0` (feat)

## Files Created/Modified

- `orchestrator/src/lib/video/validators.ts` - URL parsing for YouTube/Loom with regex patterns
- `orchestrator/src/lib/video/formatters.ts` - Timestamp formatting and transcript builders
- `orchestrator/src/lib/video/extractCaptions.ts` - YouTube caption extraction with typed interfaces
- `orchestrator/src/lib/video/index.ts` - Barrel exports for the video module
- `orchestrator/package.json` - Added youtube-caption-extractor dependency

## Decisions Made

- **Library choice:** youtube-caption-extractor (^1.9.1) selected for serverless compatibility and no API key requirement
- **URL formats supported:** watch?v=, youtu.be/, embed/, shorts/, youtube-nocookie.com
- **Loom handling:** Detected via regex but returns platform="loom" for future implementation
- **Timestamp format:** Dynamic based on video length (M:SS vs H:MM:SS)
- **Interface pattern:** CaptionExtractionResult mirrors ExtractionResult from lib/files/

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- lib/video/ module ready for use by Plan 02 (Video API Endpoint)
- All exports typed and available via barrel import
- No blockers for next plan

---
*Phase: 14.5-video-caption-fetch*
*Completed: 2026-01-23*
