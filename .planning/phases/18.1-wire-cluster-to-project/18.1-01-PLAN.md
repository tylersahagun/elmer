---
phase: 18.1-wire-cluster-to-project
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - orchestrator/src/components/signals/SignalClustersPanel.tsx
  - orchestrator/src/app/(dashboard)/workspace/[id]/signals/SignalsPageClient.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User can view signal clusters discovered by /synthesize API"
    - "Each cluster displays theme, signal count, and severity"
    - "User can click 'Create Project' to open CreateProjectFromClusterModal"
    - "Modal successfully creates project and links signals"
  artifacts:
    - path: "orchestrator/src/components/signals/SignalClustersPanel.tsx"
      provides: "Cluster discovery UI with synthesize button and cluster cards"
      min_lines: 100
    - path: "orchestrator/src/app/(dashboard)/workspace/[id]/signals/SignalsPageClient.tsx"
      provides: "Integration of SignalClustersPanel into signals page"
      contains: "SignalClustersPanel"
  key_links:
    - from: "SignalClustersPanel.tsx"
      to: "/api/signals/synthesize"
      via: "useMutation POST"
      pattern: "fetch.*api/signals/synthesize"
    - from: "SignalClustersPanel.tsx"
      to: "CreateProjectFromClusterModal"
      via: "import and render"
      pattern: "import.*CreateProjectFromClusterModal"
    - from: "SignalsPageClient.tsx"
      to: "SignalClustersPanel"
      via: "import and render"
      pattern: "<SignalClustersPanel"
---

<objective>
Wire CreateProjectFromClusterModal into signals page UI so users can discover signal clusters and create projects from them.

Purpose: Close verification gap from Phase 18 - PROV-05 blocked because CreateProjectFromClusterModal exists but is orphaned (not imported anywhere)
Output: Working cluster discovery UI with "Create Project" action per cluster
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-provenance-prd-citation/18-VERIFICATION.md

# Gap context - existing artifacts that need wiring
@orchestrator/src/components/signals/CreateProjectFromClusterModal.tsx
@orchestrator/src/app/api/signals/synthesize/route.ts
@orchestrator/src/lib/classification/clustering.ts
@orchestrator/src/app/(dashboard)/workspace/[id]/signals/SignalsPageClient.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SignalClustersPanel component</name>
  <files>orchestrator/src/components/signals/SignalClustersPanel.tsx</files>
  <action>
Create a collapsible panel component that:

1. Shows a "Discover Patterns" button that calls POST /api/signals/synthesize
2. Uses useMutation for the synthesize call with loading state
3. Displays results as cluster cards showing:
   - Theme (from cluster.theme)
   - Signal count badge
   - Severity badge (color-coded: critical=red, high=orange, medium=yellow, low=gray)
   - Suggested action badge ("new_project" -> "Create Project")
   - Preview of first 2-3 signal verbatims (truncated)
4. Each cluster card has a "Create Project" button (only if suggestedAction === "new_project")
5. Manages selectedCluster state and isModalOpen state
6. Renders CreateProjectFromClusterModal when a cluster is selected

Component structure:
```typescript
interface SignalClustersPanelProps {
  workspaceId: string;
}

export function SignalClustersPanel({ workspaceId }: SignalClustersPanelProps) {
  const [clusters, setClusters] = useState<SignalCluster[]>([]);
  const [selectedCluster, setSelectedCluster] = useState<SignalCluster | null>(null);

  const synthesizeMutation = useMutation({
    mutationFn: () => fetch('/api/signals/synthesize', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ workspaceId }),
    }).then(res => res.json()),
    onSuccess: (data) => setClusters(data.clusters || []),
  });

  return (
    <div className="mb-6 border rounded-lg p-4">
      <div className="flex items-center justify-between mb-4">
        <h3>Signal Clusters</h3>
        <Button onClick={() => synthesizeMutation.mutate()}>
          Discover Patterns
        </Button>
      </div>

      {/* Cluster cards grid */}
      {clusters.length > 0 && (
        <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
          {clusters.map(cluster => (
            <ClusterCard
              key={cluster.id}
              cluster={cluster}
              onCreateProject={() => setSelectedCluster(cluster)}
            />
          ))}
        </div>
      )}

      <CreateProjectFromClusterModal
        isOpen={!!selectedCluster}
        onClose={() => setSelectedCluster(null)}
        cluster={selectedCluster!}
        workspaceId={workspaceId}
      />
    </div>
  );
}
```

Use existing UI components: Button, Badge from @/components/ui, Loader2 from lucide-react.

Match the SignalCluster interface from CreateProjectFromClusterModal.tsx (id, theme, signals, signalCount).
  </action>
  <verify>
TypeScript compiles: `cd orchestrator && npx tsc --noEmit`
Component exports SignalClustersPanel
  </verify>
  <done>
SignalClustersPanel component exists with synthesize button, cluster cards, and modal integration
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire SignalClustersPanel into signals page</name>
  <files>orchestrator/src/app/(dashboard)/workspace/[id]/signals/SignalsPageClient.tsx</files>
  <action>
Integrate SignalClustersPanel into SignalsPageClient.tsx:

1. Add import at top:
```typescript
import { SignalClustersPanel } from "@/components/signals/SignalClustersPanel";
```

2. Render SignalClustersPanel below the suggestions banner but above the signals table:
```typescript
return (
  <div className="container mx-auto py-6 px-4">
    {/* AI Suggestions Banner */}
    <SignalSuggestionsBanner workspaceId={workspaceId} />

    {/* Signal Clusters Discovery - NEW */}
    <SignalClustersPanel workspaceId={workspaceId} />

    <SignalsTable
      workspaceId={workspaceId}
      onViewSignal={(signal) => setSelectedSignal(signal as Signal)}
      onCreateSignal={() => setShowCreateModal(true)}
    />
    {/* ... rest unchanged */}
  </div>
);
```

This placement makes sense because:
- Clusters are discovered from unlinked signals
- Users see cluster patterns before the full signals table
- Matches the flow: suggestions -> clusters -> all signals
  </action>
  <verify>
TypeScript compiles: `cd orchestrator && npx tsc --noEmit`
Grep confirms import: `grep -n "SignalClustersPanel" orchestrator/src/app/\(dashboard\)/workspace/\[id\]/signals/SignalsPageClient.tsx`
  </verify>
  <done>
SignalsPageClient imports and renders SignalClustersPanel, completing the UI wiring
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `cd orchestrator && npx tsc --noEmit` - TypeScript compiles without errors
2. Grep for orphaned modal: `grep -r "CreateProjectFromClusterModal" orchestrator/src` - now imported in SignalClustersPanel.tsx
3. Manual verification: Navigate to signals page, click "Discover Patterns", see clusters, click "Create Project" on a cluster
</verification>

<success_criteria>
- SignalClustersPanel.tsx exists and is substantive (100+ lines)
- CreateProjectFromClusterModal is imported in SignalClustersPanel.tsx
- SignalClustersPanel is imported and rendered in SignalsPageClient.tsx
- TypeScript compiles without errors
- User can: click Discover Patterns -> view clusters -> click Create Project -> modal opens -> create project
</success_criteria>

<output>
After completion, create `.planning/phases/18.1-wire-cluster-to-project/18.1-01-SUMMARY.md`
</output>
